<!doctype html>
<html lang="pl">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="initial-scale=1,user-scalable=no,maximum-scale=1,width=device-width">
        <meta name="mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <link rel="stylesheet" href="css/leaflet1.css">
		<!--link href = "https://code.jquery.com/ui/1.10.4/themes/ui-lightness/jquery-ui.css"
         rel = "stylesheet"-->
		<!--link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/font-awesome/4.6.1/css/font-awesome.min.css"><link rel="stylesheet" href="css/L.Control.Locate.min.css"-->
		<link rel="preconnect" href="https://fonts.gstatic.com">
		<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700;900&display=swap" rel="stylesheet"> 
        <link rel="stylesheet" href="css/qgis2web.css">
		<link rel="stylesheet" href="css/style.css">
		<link rel="stylesheet" href="css/leaflet-search.css">
		<link rel="stylesheet" href="css/leaflet-loader.css" />
        <style>
        html, body, #map {
            width: 100%;
            height: 100%;
            padding: 0;
            margin: 0;
        }
        </style>
		<style id="workAround"></style>
		<script src="js/jquery-3.5.1.min.js"></script>
		<script>
		</script>
        <title>Struktura wiekowa 1999 - 2019</title>
    </head>
    <body>
        <div id="map">
        </div>
		
        <script src="js/qgis2web_expressions.js"></script>
        <script src="js/leaflet.js"></script><!--script src="js/L.Control.Locate.min.js"></script-->
        <script src="js/leaflet.rotatedMarker.js"></script>
        <script src="js/leaflet.pattern.js"></script>
        <script src="js/leaflet-hash.js"></script>
        <script src="js/Autolinker.min.js"></script>
        <script src="js/rbush.min.js"></script>
        <script src="js/labelgun.min.js"></script>
        <script src="js/labels.js"></script>
		<script src="js/leaflet-search.src.js"></script>
		<!--script src="js/leaflet-loader.js"></script-->
        <!--script src="js/topojson.min.js"></script-->
        <script src="data/Demografia5.js"></script>
		<!--script src="https://unpkg.com/leaflet-draw@1.0.4/dist/leaflet.draw.js"></script-->
		<script src="data/Powiaty_Simplified_4.js"></script>
        <script src="data/Granicewojewdztw_4.js"></script>
		<script src="js/leaflet.geometryutil.js"></script>
        <script>
		var JEkod = {};
		var JEnazwa = {};
		var JEudzial = {};
		var JEkolor ={};
		var WEkod = {};
		var WEnazwa = {};
		var WEudzial = {};
		var WEkolor ={};
		var WEpow = {};
		var PLkod = {};
		var PLnazwa = {};
		var PLudzial = {};
		var PLkolor ={};
		var PLpow ={};
		var PLwoj ={};
		
		var layers = {};
		
		var licznik =0;
		var sc;
		var layer_code = 0;
		var l1, l2, l3, l4, l5, l6, l7,l8,l9;
		var h3o = '<h5 style="margin-bottom: 8px;">'+'';
		var tabso = '</h5>'+
					'<div class="tabs">'+
						'<ul class="tab-links">'+
							'<li class="active">'+'<a href="#tab1">Podsumowanie</a>'+'</li>'+
							'<li>'+'<a href="#tab2">1999</a>'+'</li>'+
							'<li>'+'<a href="#tab3">2009</a>'+'</li>'+
							'<li>'+'<a href="#tab4">2019</a>'+'</li>'+
						'</ul>'+
				'<div style="width: 656px; height: 16px; margin-left: -60px; margin-top: -16px; background-image: linear-gradient(to bottom, #fff, #fff 8px, #f4f4f4 16px); border-radius: 16px 16px 0 0; z-index: 960; box-shadow: 5px 5px 3px rgba(80, 128, 80, 0.25), -5px 5px 3px rgba(80, 128, 80, 0.25); overflow: hidden;"></div>'+
				'<div class="tab-content">'+
				'<div id="tab1" class="tab active">'+
					'<div>'+
						'<h5 style="text-align: center; color: #282828;">Struktura wiekowa mieszkańców ';
			var tableo = ' w&nbsp;latach 1999, 2009 i 2019:</h5>\
				<table class = "tabela" id="Podsumowanie">\
					<thead>\
						<tr style="background: none;">\
							<th style="border-right: 2px solid #eee; border-top-left-radius: 32px;"></th>\
							<th><b>1999</b></th>\
							<th><b>2009</b></th>\
							<th style="border-right: 2px solid #eee;"><b>2019</b></th>\
							<th><b>1999->2009</b></th>\
							<th><b>2009->2019</b></th>\
							<th>1999->2019</b></th>\
						</tr>\
					</thead>\
					<tbody>';
				var tabc = '</tbody>\
								</table>\
							</div>\
						</div>\
						<div id="tab2" class="tab">\
							<p>Błąd wczytywania danych. Proszę spróbować ponownie za kilka chwil.</p>\
						</div>\
						\
						<div id="tab3" class="tab">\
							<p>Błąd wczytywania danych. Proszę spróbować ponownie za kilka chwil.</p>\
						</div>\
						\
						<div id="tab4" class="tab">\
							<p>Błąd wczytywania danych. Proszę spróbować ponownie za kilka chwil.</p>\
						</div>\
					</div>';
				var divclear = '<div style="clear:both;"></div></div>';
		var popOpened = false;
		
				/*$(function() {
			$("li").click(function(e) {
			  e.preventDefault();
			  $("li").removeClass("active");
			  $(this).addClass("active");
			});
		});*/

		
		var bounds_group = new L.featureGroup([]);
		function lengthToZerous(number) {
			/*var ntext1 = "";
			var length = number.toString().length;
			for (i=0; i<3-length; i++){
				ntext1 = ntext1;
			}
			return ntext1;*/
			if (number>=100) return Autolinker.link(String(number));
			if (number >=10) return "0"+ Autolinker.link(String(number));
			if (number < 10) return "00"+ Autolinker.link(String(number));
		}
		
		
		function numberWithSpaces(x) {
			return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, "&nbsp;");
		}
		
		function lengthToBlank(number) {
			var ntext = '';
			var length = number.toString().length;
			for (i=0; i<6-length; i++){
				ntext = ntext + "&#8199;";
			}
			if (length<4) ntext = ntext + "&nbsp;";
			return ntext;
		}
		
		/*function lengthToBlank1(number) {
			var ntext = [];
			//var ctext ='';
			var percent ;
			percent = number.toFixed(2);
				
			var length = percent.length;
			for (i=0; i<5-length; i++){
				ntext .push("&#8199;");
			}
			ntext .push(percent);
			return ntext.join("");
		}*/
		function lengthToBlank1(number) {
			var percent  = number.toFixed(2);
			if (number/10>=1){
				return percent;
			}else{
				return "&#8199;"+percent;
			}
		}
		
		function lengthToBlank2(number) {
			var ntext = [];
			var percent ;
			if(number>0){
				percent = "+"+number.toFixed(2);
			}else{
				percent = number.toFixed(2);
			}
				
			var length = percent.length;
			for (i=0; i<7-length; i++){
				ntext .push("&#8199;");
			}
			/*if (length<4) ntext = ntext + "&#8199;";*/
			ntext .push(percent);
			return ntext.join("");
		}
		
		function lengthToBlank3(number) {
			var ntext = [];
			var percent ;
			if(number>0){
				percent = "+"+number.toFixed(2);
			}else{
				percent = number.toFixed(2);
			}
				
			var length = percent.length;
			for (i=0; i<6-length; i++){
				ntext .push("&#8199;");
			}
			/*if (length<4) ntext = ntext + "&#8199;";*/
			ntext .push(percent);
			return ntext.join("");
		}
		
		function lengthToBlank4(number) {
			var ntext = "";
			var length = number.toString().length;
			for (i=0; i<7-length; i++){
				ntext = ntext + "&#8199;";
			}
			/*if (length<4) ntext = ntext + "&#8199;";*/
			if (length<7) ntext = ntext + "&nbsp;";
			return ntext;
			
		}
		
        function pop_dem99(feature, layer) {
            layer.bindPopup(popupContent, {maxHeight: 800});
        }
		
		var pow_at1 ;
		/*var pow_at1 = json_Demografia;
		delete pow_at1.features.geometry;*/
		
		json_Demografia.getFeaturesByProperty = function(key, value) {
		  return this.features.filter(function(feature){
			if (feature.properties[key] === value) {
			  return true;
			} else {
			  return false;
			}
		  });
		};
		/*pow_at1.getFeaturesByProperty = function(key, value) {
		  return this.features.filter(function(feature){
			if (feature.properties[key] === value) {
			  return true;
			} else {
			  return false;
			}
		  });
		};*/
		json_Powiaty_Simplified_1.getFeaturesByProperty = function(key, value) {
		  return this.features.filter(function(feature){
			if (feature.properties[key] === value) {
			  return true;
			} else {
			  return false;
			}
		  });
		};
		json_Granicewojewdztw_2.getFeaturesByProperty = function(key, value) {
		  return this.features.filter(function(feature){
			if (feature.properties[key] === value) {
			  return true;
			} else {
			  return false;
			}
		  });
		};
		const sortArrayofObjects = (property, order) => {
		  var sortOrder = order === 'asc' ? 1 : -1;
		  //var topIds = [100.0, 0.0];
		  return function (a, b) {
			 var result = (a['properties'][property] < b['properties'][property]) ? -1 : (a['properties'][property] > b['properties'][property]) ? 1 : 0;
			  return result * sortOrder;
			 /* return topIds.includes(b['properties'][property]) - topIds.includes(a['properties'][property]) || b['properties'][property] - a['properties'][property];*/
		  }
		};
		/*var feats =  json_Demografia.getFeaturesByProperty('D_D2019a', 22.5);
		var featz = json_Powiaty_Simplified_1.getFeaturesByProperty('JPT_KOD_JE', feats[0].properties.Powiat);
		console.log(feats[0].properties.JPT_NAZWA_+" "+featz[0].properties.JPT_NAZWA_);
		for (s=0;s<feats.length; s++) {
			featz = json_Powiaty_Simplified_1.getFeaturesByProperty('JPT_KOD_JE', feats[s].properties.Powiat);
			console.log(feats[s].properties.JPT_NAZWA_+" "+featz[0].properties.JPT_NAZWA_);
		}*/
		

        function style_D1999(feature) {
            return {
                pane: 'pane_Okregi_0',
                opacity: 1,
                color: 'rgba(32,32,32,0.2)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 0.1, 
                fill: true,
                fillOpacity: 0.9,
                fillColor: feature.properties["D_D1999a"]==0.0?'rgba(255,255,255,0.8)': feature.properties["D99rgb"],
            }
        }
		
		function style_D2009(feature) {
            return {
                pane: 'pane_Okregi_0',
                opacity: 1,
                color: 'rgba(32,32,32,0.2)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 0.1, 
                fill: true,
                fillOpacity: 0.9,
                fillColor: feature.properties["D_D2009a"]==0.0?'rgba(255,255,255,0.8)': feature.properties["D09rgb"],
            }
        }
		
		function style_D2019(feature) {
            return {
                pane: 'pane_Okregi_0',
                opacity: 1,
                color: 'rgba(32,32,32,0.2)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 0.1, 
                fill: true,
                fillOpacity: 0.9,
                fillColor: /*hexToRgbA(*/feature.properties["D_D2019a"]==0.0?'rgba(255,255,255,0.8)': feature.properties["D19rgb"],
            }
        }
		function style_D09_99(feature) {
            return {
                pane: 'pane_Okregi_0',
                opacity: 1,
                color: 'rgba(32,32,32,0.2)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 0.1, 
                fill: true,
                fillOpacity: 0.9,
                fillColor: /*hexToRgbA(*/feature.properties["D_D1999a"]==0.0?'rgba(255,255,255,0.8)': feature.properties["D09_99rgb"],
            }
        }function style_D19_09(feature) {
            return {
                pane: 'pane_Okregi_0',
                opacity: 1,
                color: 'rgba(32,32,32,0.2)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 0.1, 
                fill: true,
                fillOpacity: 0.9,
                fillColor: /*hexToRgbA(*/(feature.properties["D_D2019a"]==0.0||feature.properties["D_D2009a"]==0.0)?'rgba(255,255,255,0.8)': feature.properties["D19_09rgb"],
            }
        }function style_D19_99(feature) {
            return {
                pane: 'pane_Okregi_0',
                opacity: 1,
                color: 'rgba(32,32,32,0.2)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 0.1, 
                fill: true,
                fillOpacity: 0.9,
                fillColor: /*hexToRgbA(*/(feature.properties["D_D2019a"]==0.0||feature.properties["D_D1999a"]==0.0)?'rgba(255,255,255,0.8)': feature.properties["D19_99rgb"],
            }
        }
		function style_D09_99c(feature) {
            return {
                pane: 'pane_Okregi_0',
                opacity: 1,
                color: 'rgba(32,32,32,0.2)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 0.1, 
                fill: true,
                fillOpacity: 0.9,
                fillColor: /*hexToRgbA(*/feature.properties["D_D1999a"]==0.0?'rgba(255,255,255,0.8)': feature.properties["D09_99crgb"],
            }
        }function style_D19_09c(feature) {
            return {
                pane: 'pane_Okregi_0',
                opacity: 1,
                color: 'rgba(32,32,32,0.2)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 0.1, 
                fill: true,
                fillOpacity: 0.9,
                fillColor: /*hexToRgbA(*/(feature.properties["D_D2019a"]==0.0||feature.properties["D_D2009a"]==0.0)?'rgba(255,255,255,0.8)': feature.properties["D19_09crgb"],
            }
        }function style_D19_99c(feature) {
            return {
                pane: 'pane_Okregi_0',
                opacity: 1,
                color: 'rgba(32,32,32,0.2)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 0.1, 
                fill: true,
                fillOpacity: 0.9,
                fillColor: /*hexToRgbA(*/(feature.properties["D_D2019a"]==0.0||feature.properties["D_D1999a"]==0.0)?'rgba(255,255,255,0.8)': feature.properties["D19_99crgb"],
            }
        }
		
		var basemap0 = L.tileLayer('http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors,<a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>',
            maxZoom: 10
        });
		
		
		var map = L.map('map', {
            zoomControl:true, maxZoom:10, minZoom:6, layers: [basemap0]
        }).fitBounds([[48.7066734906,11.9596852528],[54.6789300376,27.5634833614]]);
		
		map.getBounds();
		
		//var controlLoader = L.control.loader().addTo(map);
		
		map.createPane('labels');
		map.getPane('labels').style.zIndex = 650;
		map.getPane('labels').style.pointerEvents = 'none';
		//map.getPane('labels').style.display = 'none';
		
		map.createPane('pane_Okregi_0');
        map.getPane('pane_Okregi_0').style.zIndex = 401;
        map.getPane('pane_Okregi_0').style['mix-blend-mode'] = 'normal';
		
		//map.addLayer(layer_Okregi_0);
		//map.addLayer(basemap0);
		//console.log(json_Demografia);
		//console.log(map.getPane('pane_Okregi_0'));
		
		
		function rank_Powiaty(feature, layer) {
			/*var pow_at = json_Demografia.getFeaturesByProperty('Powiat', feature.properties['Powiat']);
			pow_at1  = pow_at1.sort(sortArrayofObjects('D_D1999a', 'desc'));*/
			var JE = feature.properties.JPT_KOD_JE;
			var JN = feature.properties.JPT_NAZWA_;
			//console.log(JE);
			var  pow_at_ = [];
			var  pow_at = [];
			
			for (i=0; i<9; i++){
				pow_at_[i]  = json_Demografia.getFeaturesByProperty('Powiat', JE);
			}
			
			pow_at[0] = pow_at_[0].filter(function (el) {
			  return el.properties.D_D1999c < 100; 
			});
			pow_at[1] = pow_at_[1].filter(function (el) {
			  return el.properties.D_D1999c < 100; 
			});
			pow_at[2] = pow_at_[2].filter(function (el) {
			  return el.properties.D_D1999c < 100;  
			});
			pow_at[3] = pow_at_[3].filter(function (el) {
			  return el.properties.D_D2009c < 100;  
			});
			pow_at[4] = pow_at_[4].filter(function (el) {
			  return el.properties.D_D2009c < 100; 
			});
			pow_at[5] = pow_at_[5].filter(function (el) {
			  return el.properties.D_D2009c < 100; 
			});
			pow_at[6] = pow_at_[6].filter(function (el) {
			  return el.properties.D_D2019c < 100; 
			});
			pow_at[7] = pow_at_[7].filter(function (el) {
			  return el.properties.D_D2019c < 100;
			});
			pow_at[8] = pow_at_[8].filter(function (el) {
			  return el.properties.D_D2019c < 100; 
			});
			
			pow_at[0]  = pow_at[0].sort(sortArrayofObjects('D_D1999a', 'desc'));
			pow_at[1]  = pow_at[1].sort(sortArrayofObjects('D_D1999b', 'desc'));
			pow_at[2]  = pow_at[2].sort(sortArrayofObjects('D_D1999c', 'desc'));
			pow_at[3]  = pow_at[3].sort(sortArrayofObjects('D_D2009a', 'desc'));
			pow_at[4]  = pow_at[4].sort(sortArrayofObjects('D_D2009b', 'desc'));
			pow_at[5]  = pow_at[5].sort(sortArrayofObjects('D_D2009c', 'desc'));
			pow_at[6]  = pow_at[6].sort(sortArrayofObjects('D_D2019a', 'desc'));
			pow_at[7]  = pow_at[7].sort(sortArrayofObjects('D_D2019b', 'desc'));
			pow_at[8]  = pow_at[8].sort(sortArrayofObjects('D_D2019c', 'desc'));
			//var JE = [];
			var kod = [];
			var nazwa = [];
			var udzial = [];
			var kolor = [];
			for (i=0; i<9; i++){
				kod[i]  = new Array(pow_at[i].length);
				nazwa[i]  = new Array(pow_at[i].length);
				udzial[i]  = new Array(pow_at[i].length);
				kolor[i]  = new Array(pow_at[i].length);
			}
			//console.log(pow_at[8][0].properties.JPT_NAZWA_);
			//console.log(pow_at[8][1].properties.JPT_NAZWA_);
			for (i=0; i<9; i++){
				for (t=0; t<pow_at[i].length;t++){
					kod[i][t] = pow_at[i][t].properties.JPT_KOD_JE;
					nazwa[i][t] = pow_at[i][t].properties.JPT_NAZWA_;
					switch(i){
						case 0:
							udzial[i][t] = pow_at[i][t].properties.D_D1999a;
							kolor[i][t] = pow_at[i][t].properties.D99rgb;
							break;
						case 1:
							udzial[i][t] = pow_at[i][t].properties.D_D1999b;
							kolor[i][t] = pow_at[i][t].properties.D99rgb;
							break;
						case 2:
							udzial[i][t] = pow_at[i][t].properties.D_D1999c;
							kolor[i][t] = pow_at[i][t].properties.D99rgb;
							break;
						case 3:
							udzial[i][t] = pow_at[i][t].properties.D_D2009a;
							kolor[i][t] = pow_at[i][t].properties.D09rgb;
							break;
						case 4:
							udzial[i][t] = pow_at[i][t].properties.D_D2009b;
							kolor[i][t] = pow_at[i][t].properties.D09rgb;
							break;
						case 5:
							udzial[i][t] = pow_at[i][t].properties.D_D2009c;
							kolor[i][t] = pow_at[i][t].properties.D09rgb;
							break;
						case 6:
							udzial[i][t] = pow_at[i][t].properties.D_D2019a;
							kolor[i][t] = pow_at[i][t].properties.D19rgb;
							break;
						case 7:
							udzial[i][t] = pow_at[i][t].properties.D_D2019b;
							kolor[i][t] = pow_at[i][t].properties.D19rgb;
							break;
						case 8:
							udzial[i][t] = pow_at[i][t].properties.D_D2019c;
							kolor[i][t] = pow_at[i][t].properties.D19rgb;
							break;
						default:
							udzial[i][t] = 0;
							kolor[i][t] = '#ffffff';
					}
					/*udzial[i][t] = pow_at[i][t].properties.D_D1999a;*/
				}
			}
			JEkod[JE] = kod;
			JEnazwa[JE] = nazwa;
			JEudzial[JE] = udzial;
			JEkolor[JE] = kolor;
			/*JEkod.push(layer);*/
			/*console.log(JN);
			console.log(JEkod[JE]);*/
		}
		
		function rank_Wojewod(feature, layer) {
			/*var woj_at = json_Demografia.getFeaturesByProperty('Powiat', feature.properties['Powiat']);
			woj_at1  = woj_at1.sort(sortArrayofObjects('D_D1999a', 'desc'));*/
			var WE = feature.properties.Wojewod;
			var WN = feature.properties.JPT_NAZWA_;
			//console.log(WE);
			var  woj_at_ = [];
			var  woj_at = [];
			
			for (i=0; i<9; i++){
				woj_at_[i]  = json_Demografia.getFeaturesByProperty('Wojewod', WE);
			}
			
			woj_at[0] = woj_at_[0].filter(function (el) {
			  return el.properties.D_D1999c < 100; 
			});
			woj_at[1] = woj_at_[1].filter(function (el) {
			  return el.properties.D_D1999c < 100; 
			});
			woj_at[2] = woj_at_[2].filter(function (el) {
			  return el.properties.D_D1999c < 100;  
			});
			woj_at[3] = woj_at_[3].filter(function (el) {
			  return el.properties.D_D2009c < 100;  
			});
			woj_at[4] = woj_at_[4].filter(function (el) {
			  return el.properties.D_D2009c < 100; 
			});
			woj_at[5] = woj_at_[5].filter(function (el) {
			  return el.properties.D_D2009c < 100; 
			});
			woj_at[6] = woj_at_[6].filter(function (el) {
			  return el.properties.D_D2019c < 100; 
			});
			woj_at[7] = woj_at_[7].filter(function (el) {
			  return el.properties.D_D2019c < 100;
			});
			woj_at[8] = woj_at_[8].filter(function (el) {
			  return el.properties.D_D2019c < 100; 
			});
			
			woj_at[0]  = woj_at[0].sort(sortArrayofObjects('D_D1999a', 'desc'));
			woj_at[1]  = woj_at[1].sort(sortArrayofObjects('D_D1999b', 'desc'));
			woj_at[2]  = woj_at[2].sort(sortArrayofObjects('D_D1999c', 'desc'));
			woj_at[3]  = woj_at[3].sort(sortArrayofObjects('D_D2009a', 'desc'));
			woj_at[4]  = woj_at[4].sort(sortArrayofObjects('D_D2009b', 'desc'));
			woj_at[5]  = woj_at[5].sort(sortArrayofObjects('D_D2009c', 'desc'));
			woj_at[6]  = woj_at[6].sort(sortArrayofObjects('D_D2019a', 'desc'));
			woj_at[7]  = woj_at[7].sort(sortArrayofObjects('D_D2019b', 'desc'));
			woj_at[8]  = woj_at[8].sort(sortArrayofObjects('D_D2019c', 'desc'));
			//var WE = [];
			var kod = [];
			var nazwa = [];
			var udzial = [];
			var kolor = [];
			var powiat = [];
			for (i=0; i<9; i++){
				kod[i]  = new Array(woj_at[i].length);
				nazwa[i]  = new Array(woj_at[i].length);
				udzial[i]  = new Array(woj_at[i].length);
				kolor[i]  = new Array(woj_at[i].length);
				powiat[i]  = new Array(woj_at[i].length);
			}
			//console.log(woj_at[8][0].properties.JPT_NAZWA_);
			//console.log(woj_at[8][1].properties.JPT_NAZWA_);
			for (i=0; i<9; i++){
				for (t=0; t<woj_at[i].length;t++){
					kod[i][t] = woj_at[i][t].properties.JPT_KOD_JE;
					nazwa[i][t] = woj_at[i][t].properties.JPT_NAZWA_;
					powiat[i][t] = woj_at[i][t].properties.Powiat;
					
					switch(i){
						case 0:
							udzial[i][t] = woj_at[i][t].properties.D_D1999a;
							kolor[i][t] = woj_at[i][t].properties.D99rgb;
							break;
						case 1:
							udzial[i][t] = woj_at[i][t].properties.D_D1999b;
							kolor[i][t] = woj_at[i][t].properties.D99rgb;
							break;
						case 2:
							udzial[i][t] = woj_at[i][t].properties.D_D1999c;
							kolor[i][t] = woj_at[i][t].properties.D99rgb;
							break;
						case 3:
							udzial[i][t] = woj_at[i][t].properties.D_D2009a;
							kolor[i][t] = woj_at[i][t].properties.D09rgb;
							break;
						case 4:
							udzial[i][t] = woj_at[i][t].properties.D_D2009b;
							kolor[i][t] = woj_at[i][t].properties.D09rgb;
							break;
						case 5:
							udzial[i][t] = woj_at[i][t].properties.D_D2009c;
							kolor[i][t] = woj_at[i][t].properties.D09rgb;
							break;
						case 6:
							udzial[i][t] = woj_at[i][t].properties.D_D2019a;
							kolor[i][t] = woj_at[i][t].properties.D19rgb;
							break;
						case 7:
							udzial[i][t] = woj_at[i][t].properties.D_D2019b;
							kolor[i][t] = woj_at[i][t].properties.D19rgb;
							break;
						case 8:
							udzial[i][t] = woj_at[i][t].properties.D_D2019c;
							kolor[i][t] = woj_at[i][t].properties.D19rgb;
							break;
						default:
							udzial[i][t] = 0;
							kolor[i][t] = '#ffffff';
					}
					/*udzial[i][t] = woj_at[i][t].properties.D_D1999a;*/
				}
			}
			WEkod[WE] = kod;
			WEnazwa[WE] = nazwa;
			WEudzial[WE] = udzial;
			WEkolor[WE] = kolor;
			WEpow[WE] = powiat;
			/*WEkod.push(layer);*/
			/*console.log(WN);*/
			/*console.log(WEkod[WE]);*/
		}
		
		function rank_PL() {
			/*var pl_at = json_Demografia.getFeaturesByProperty('Powiat', feature.properties['Powiat']);
			pl_at1  = pl_at1.sort(sortArrayofObjects('D_D1999a', 'desc'));*/
			/*var PL = feature.properties.Wojewod;
			var WN = feature.properties.JPT_NAZWA_;*/
			//console.log(PL);
			var  pl_at_ = [];
			var  pl_at = [];
			
			for (i=0; i<9; i++){
				pl_at_[i] = new Array(json_Demografia.features.length);
				for (t=0; t< json_Demografia.features.length; t++){
					pl_at_[i][t]  = json_Demografia.features[t];
				}
			}
			pl_at[0] = pl_at_[0].filter(function (el) {
			  return el.properties.D_D1999c < 100; 
			});
			pl_at[1] = pl_at_[1].filter(function (el) {
			  return el.properties.D_D1999c < 100; 
			});
			pl_at[2] = pl_at_[2].filter(function (el) {
			  return el.properties.D_D1999c < 100;  
			});
			pl_at[3] = pl_at_[3].filter(function (el) {
			  return el.properties.D_D2009c < 100;  
			});
			pl_at[4] = pl_at_[4].filter(function (el) {
			  return el.properties.D_D2009c < 100; 
			});
			pl_at[5] = pl_at_[5].filter(function (el) {
			  return el.properties.D_D2009c < 100; 
			});
			pl_at[6] = pl_at_[6].filter(function (el) {
			  return el.properties.D_D2019c < 100; 
			});
			pl_at[7] = pl_at_[7].filter(function (el) {
			  return el.properties.D_D2019c < 100;
			});
			pl_at[8] = pl_at_[8].filter(function (el) {
			  return el.properties.D_D2019c < 100; 
			});
			console.log(pl_at_[8][0].properties.JPT_NAZWA_+' aaa');
			console.log(pl_at[8][0].properties.JPT_NAZWA_+' bbb');
			pl_at[0]  = pl_at[0].sort(sortArrayofObjects('D_D1999a', 'desc'));
			pl_at[1]  = pl_at[1].sort(sortArrayofObjects('D_D1999b', 'desc'));
			pl_at[2]  = pl_at[2].sort(sortArrayofObjects('D_D1999c', 'desc'));
			pl_at[3]  = pl_at[3].sort(sortArrayofObjects('D_D2009a', 'desc'));
			pl_at[4]  = pl_at[4].sort(sortArrayofObjects('D_D2009b', 'desc'));
			pl_at[5]  = pl_at[5].sort(sortArrayofObjects('D_D2009c', 'desc'));
			pl_at[6]  = pl_at[6].sort(sortArrayofObjects('D_D2019a', 'desc'));
			pl_at[7]  = pl_at[7].sort(sortArrayofObjects('D_D2019b', 'desc'));
			pl_at[8]  = pl_at[8].sort(sortArrayofObjects('D_D2019c', 'desc'));
			//var PL = [];
			console.log(pl_at[8][0].properties.JPT_NAZWA_+' ccc');
			var kod = [];
			var nazwa = [];
			var udzial = [];
			var kolor = [];
			var powiat = [];
			var wojewod = [];
			
			for (i=0; i<9; i++){
				kod[i]  = new Array(pl_at[i].length);
				nazwa[i]  = new Array(pl_at[i].length);
				udzial[i]  = new Array(pl_at[i].length);
				kolor[i]  = new Array(pl_at[i].length);
				powiat[i]  = new Array(pl_at[i].length);
				wojewod[i]  = new Array(pl_at[i].length);
			}
			//console.log(pl_at[8][0].properties.JPT_NAZWA_);
			//console.log(pl_at[8][1].properties.JPT_NAZWA_);
			for (i=0; i<9; i++){
				for (t=0; t<pl_at[i].length;t++){
					kod[i][t] = pl_at[i][t].properties.JPT_KOD_JE;
					nazwa[i][t] = pl_at[i][t].properties.JPT_NAZWA_;
					powiat[i][t] = pl_at[i][t].properties.Powiat;
					wojewod[i][t] = pl_at[i][t].properties.Wojewod;
					switch(i){
						case 0:
							udzial[i][t] = pl_at[i][t].properties.D_D1999a;
							kolor[i][t] = pl_at[i][t].properties.D99rgb;
							break;
						case 1:
							udzial[i][t] = pl_at[i][t].properties.D_D1999b;
							kolor[i][t] = pl_at[i][t].properties.D99rgb;
							break;
						case 2:
							udzial[i][t] = pl_at[i][t].properties.D_D1999c;
							kolor[i][t] = pl_at[i][t].properties.D99rgb;
							break;
						case 3:
							udzial[i][t] = pl_at[i][t].properties.D_D2009a;
							kolor[i][t] = pl_at[i][t].properties.D09rgb;
							break;
						case 4:
							udzial[i][t] = pl_at[i][t].properties.D_D2009b;
							kolor[i][t] = pl_at[i][t].properties.D09rgb;
							break;
						case 5:
							udzial[i][t] = pl_at[i][t].properties.D_D2009c;
							kolor[i][t] = pl_at[i][t].properties.D09rgb;
							break;
						case 6:
							udzial[i][t] = pl_at[i][t].properties.D_D2019a;
							kolor[i][t] = pl_at[i][t].properties.D19rgb;
							break;
						case 7:
							udzial[i][t] = pl_at[i][t].properties.D_D2019b;
							kolor[i][t] = pl_at[i][t].properties.D19rgb;
							break;
						case 8:
							udzial[i][t] = pl_at[i][t].properties.D_D2019c;
							kolor[i][t] = pl_at[i][t].properties.D19rgb;
							break;
						default:
							udzial[i][t] = 0;
							kolor[i][t] = '#ffffff';
					}
					/*udzial[i][t] = pl_at[i][t].properties.D_D1999a;*/
				}
			}
			PLkod = kod;
			PLnazwa = nazwa;
			PLudzial= udzial;
			PLkolor = kolor;
			PLpow = powiat;
			PLwoj = wojewod;
			/*PLkod.push(layer);*/
			/*console.log(WN);*/
			/*console.log(PLnazwa[1]+'aaa');*/
		}
		rank_PL();
		/*console.log(PLkod+' aaa');*/
        map.createPane('pane_Powiaty_Simplified_2');
        map.getPane('pane_Powiaty_Simplified_2').style.zIndex = 401;
        map.getPane('pane_Powiaty_Simplified_2').style['mix-blend-mode'] = 'normal';
        var layer_Powiaty_Simplified_2 = new L.geoJson(json_Powiaty_Simplified_1, {
            pane: 'pane_Powiaty_Simplified_2',
            onEachFeature: rank_Powiaty,
            style: style_Powiaty_Simplified_2_0,
        });
        //bounds_group.addLayer(layer_Powiaty_Simplified_2);
        //map.addLayer(layer_Powiaty_Simplified_2);
		/*console.log(JEkod['3024']);*/
		/*console.log(WEkod['30']);*/
		//var KEs = JEkod;
		
        var layer_1999 = new L.geoJson(json_Demografia, {
			name: 'D1999',
			pane: 'pane_Okregi_0',
            onEachFeature: pop_Gm_0,
            style: style_D1999,
        }).addTo(map);
		
		var layer_2009 = new L.geoJson( json_Demografia, {
            pane: 'pane_Okregi_0',
            onEachFeature: pop_Gminy_0,
            style: style_D2009,
        })/*.addTo(map);*/
		
		var layer_2019 = new L.geoJson( json_Demografia, {
            pane: 'pane_Okregi_0',
            onEachFeature: pop_Gminy_0,
            style: style_D2019,
        })/*.addTo(map);*/
		
		//var layer_2019 = Object.assign({}, layer_1999);
		/*var layer_2019 = jQuery.extend(true, {}, layer_1999)
		layer_2019.setStyle(style_D2019);
		layer_1999.setStyle(style_D1999);*/
		
		var layer_09_99 = new L.geoJson( json_Demografia, {
            pane: 'pane_Okregi_0',
            onEachFeature: pop_Gminy_0,
            style: style_D09_99,
        })/*.addTo(map);*/
		
		var layer_19_09 = new L.geoJson(json_Demografia, {
            pane: 'pane_Okregi_0',
            onEachFeature: pop_Gminy_0,
            style: style_D19_09,
        })/*.addTo(map);*/
		
		var layer_19_99 = new L.geoJson( json_Demografia, {
            pane: 'pane_Okregi_0',
            onEachFeature: pop_Gminy_0,
            style: style_D19_99,
        })/*.addTo(map);*/
		
		var layer_09_99c = new L.geoJson( json_Demografia, {
            pane: 'pane_Okregi_0',
            onEachFeature: pop_Gminy_0,
            style: style_D09_99c,
        })/*.addTo(map);*/
		
		var layer_19_09c = new L.geoJson( json_Demografia, {
            pane: 'pane_Okregi_0',
            onEachFeature: pop_Gminy_0,
            style: style_D19_09c,
        })/*.addTo(map);*/
		
		var layer_19_99c = new L.geoJson(json_Demografia, {
            pane: 'pane_Okregi_0',
            onEachFeature: pop_Gminy_0,
            style: style_D19_99c,
        })/*.addTo(map);*/
		
		function pop_Powiaty_Simplified_1(feature, layer) {
            var popupContent = '<table>\
                </table>';
            layer.bindPopup(popupContent, {maxHeight: 400});
        }
		
		function style_Powiaty_Simplified_1_0() {
            return {
                pane: 'pane_Powiaty_Simplified_1',
                opacity: 1,
                color: 'rgba(96,96,96,1.0)',
                dashArray: '',
                lineCap: 'round',
                lineJoin: 'round',
                weight: 0.8, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(200,162,240,0.0)',
				interactive: false,
            }
        }
        map.createPane('pane_Powiaty_Simplified_1');
        map.getPane('pane_Powiaty_Simplified_1').style.zIndex = 403;
        map.getPane('pane_Powiaty_Simplified_1').style['mix-blend-mode'] = 'normal';
        var layer_Powiaty_Simplified_1 = new L.geoJson(json_Powiaty_Simplified_1, {
            pane: 'pane_Powiaty_Simplified_1',
            onEachFeature: pop_Powiaty_Simplified_1,
            style: style_Powiaty_Simplified_1_0,
        });
        //bounds_group.addLayer(layer_Powiaty_Simplified_1);
       // map.addLayer(layer_Powiaty_Simplified_1);
		
		function style_Powiaty_Simplified_2_0() {
            return {
                pane: 'pane_Powiaty_Simplified_2',
                opacity: 1,
                color: 'rgba(192,192,192,1.0)',
                dashArray: '',
                lineCap: 'round',
                lineJoin: 'round',
                weight: 1.2, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(200,162,240,0.0)',
				interactive: false,
            }
        }
		

        function pop_Granicewojewdztw_2(feature, layer) {
            var popupContent = '<table>\
                </table>';
            layer.bindPopup(popupContent, {maxHeight: 400});
        }

        function style_Granicewojewdztw_2_0() {
            return {
                pane: 'pane_Granicewojewdztw_2',
                opacity: 1,
                color: 'rgba(80,80,80,1.0)',
                dashArray: '',
                lineCap: 'round',
                lineJoin: 'round',
                weight: 1.6, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(154,206,98,0.0)',
				interactive: false,
            }
        }
        map.createPane('pane_Granicewojewdztw_2');
        map.getPane('pane_Granicewojewdztw_2').style.zIndex = 404;
        map.getPane('pane_Granicewojewdztw_2').style['mix-blend-mode'] = 'normal';
        var layer_Granicewojewdztw_2 = new L.geoJson(json_Granicewojewdztw_2 , {
            pane: 'pane_Granicewojewdztw_2',
            onEachFeature: rank_Wojewod,
            style: style_Granicewojewdztw_2_0,
        });
        //bounds_group.addLayer(layer_Granicewojewdztw_2);
        //map.addLayer(layer_Granicewojewdztw_2);
		/*console.log(WEkod['30']);*/
		
		function style_Granicewojewdztw_1_0() {
            return {
                pane: 'pane_Granicewojewdztw_1',
                opacity: 1,
                color: 'rgba(224,224,224,1.0)',
                dashArray: '',
                lineCap: 'round',
                lineJoin: 'round',
                weight: 2.4, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(154,206,98,0.0)',
				interactive: false,
            }
        }
        map.createPane('pane_Granicewojewdztw_1');
        map.getPane('pane_Granicewojewdztw_1').style.zIndex = 402;
        map.getPane('pane_Granicewojewdztw_1').style['mix-blend-mode'] = 'normal';
		//var layer_Granicewojewdztw_1 = layer_Granicewojewdztw_2;
		//layer_Granicewojewdztw_1.style.color = 'white';
        var layer_Granicewojewdztw_1 = new L.geoJson(json_Granicewojewdztw_2 , {
            pane: 'pane_Granicewojewdztw_1',
            style: style_Granicewojewdztw_1_0,
        });
        //bounds_group.addLayer(layer_Granicewojewdztw_2);
        //map.addLayer(layer_Granicewojewdztw_2);
		
		var Powiaty = L.layerGroup([layer_Powiaty_Simplified_1, layer_Powiaty_Simplified_2]);
		var Wojewod = L.layerGroup([layer_Granicewojewdztw_1, layer_Granicewojewdztw_2 ]);
		//var Demog = L.layerGroup([layer_1999, layer_2009, layer_2019, layer_09_99, layer_19_09, layer_19_99, layer_09_99c, layer_19_09c, layer_19_99c]);
		
		bounds_group.addLayer(Powiaty);
        map.addLayer(Powiaty);
		bounds_group.addLayer(Wojewod);
        map.addLayer(Wojewod);


		function pop_Gm_0(feature, layer) {
			//var pow_at = json_Demografia.getFeaturesByProperty('Powiat', feature.properties['Powiat']);
			var p = layer.feature.properties;
			var PJE = p.Powiat;
			var PWE = p.Wojewod;

			
			//json_Powiaty_Simplified_1.getFeaturesByProperty('JPT_KOD_JE', feature.properties['Powiat'])[0].properties.JPT_NAZWA_
            var popupContent ="" ;
			popupContent += h3o;
			popupContent  += p.JPT_KOD_JE.substring(6, 7) !== "1"? 'gm.' : 'm.';
			popupContent += ' ';
			popupContent  += (p.JPT_NAZWA_ !== null ? Autolinker.link(String(p.JPT_NAZWA_)) : '');
			popupContent += tabso;
			popupContent  += (p.JPT_KOD_JE.substring(6, 7) !== "1"? 'gminy' : 'miasta');
			popupContent  += tableo;
			/*var popupContent =[];
			popupContent.push(h3o);
			popupContent.push(p.JPT_KOD_JE.substring(6, 7) !== "1"? 'gm.' : 'm.');
			popupContent.push(' ');
			popupContent.push(p.JPT_NAZWA_ !== null ? Autolinker.link(String(p.JPT_NAZWA_)) : '');
			popupContent.push(tabso);
			popupContent .push(p.JPT_KOD_JE.substring(6, 7) !== "1"? 'gminy' : 'miasta');
			popupContent.push(tableo);*/
			
			popupContent  += '<tr>\
							<td>'  + '<b>Powierzchnia (ha): </b>'  + '</td>\
							<td>'+ ((feature.properties['P_1999'] !== null &&feature.properties['P_1999'] !== 'NA')? numberWithSpaces(Number(feature.properties['P_1999'])):'&mdash;') + '</td>\
							<td>' +  ((feature.properties['P_2009'] !== null  &&feature.properties['P_2009'] !== 'NA')?numberWithSpaces(Number(feature.properties['P_2009'])):'&mdash;') + '</td>\
							<td style="border-right: 2px dotted #bbb;">' +  ((feature.properties['P_2019'] !== null  &&feature.properties['P_2019'] !== 'NA')?numberWithSpaces(Number(feature.properties['P_2019'])):'&mdash;') + '</td>\
							<td style = "font-weight: 700; color:'+ ((feature.properties['P_1999'] == 'NA'|| feature.properties['P_2009'] == 'NA'||(feature.properties['P_2009']==feature.properties['P_1999']))? 'black':((feature.properties['P_2009']-feature.properties['P_1999'])<0)?'red':'green')+'">'+((feature.properties['P_1999'] !== 'NA' &&feature.properties['P_2009'] !== 'NA')? (lengthToBlank2(feature.properties['P_2009']/feature.properties['P_1999']*100-100)+'%'):'&mdash;') + '</td>\
							<td style = "font-weight: 700; color:'+ ((feature.properties['P_2019'] == 'NA' || feature.properties['P_2009'] == 'NA'||(feature.properties['P_2019']==feature.properties['P_2009']))? 'black':((feature.properties['P_2019']-feature.properties['P_2009'])<0)?'red':'green')+'">'+((feature.properties['P_2019'] !== 'NA' &&feature.properties['P_2009'] !== 'NA')? (lengthToBlank2(feature.properties['P_2019']/feature.properties['P_2009']*100-100)+'%'):'&mdash;') + '</td>\
							<td style = "font-weight: 700; color:'+ ((feature.properties['P_1999'] == 'NA' ||feature.properties['P_2019'] == 'NA'||(feature.properties['P_2019']==feature.properties['P_1999']))? 'black':((feature.properties['P_2019']-feature.properties['P_1999'])<0)?'red':'green')+'">'+((feature.properties['P_1999'] !== 'NA' &&feature.properties['P_2019'] !== 'NA')? (lengthToBlank2(feature.properties['P_2019']/feature.properties['P_1999']*100-100)+'%'):'&mdash;') + '</td>\
						</tr>\
						<tr class="divider">\
							<td>'  + '<b>Liczba mieszkańców: </b>'  + '</td>\
							<td>'+ ((feature.properties['L_1999'] !== null &&feature.properties['L_1999'] !== 'NA')? numberWithSpaces(Number(feature.properties['L_1999'])):'&mdash;') + '</td>\
							<td>' +  ((feature.properties['L_2009'] !== null  &&feature.properties['L_2009'] !== 'NA')?numberWithSpaces(Number(feature.properties['L_2009'])):'&mdash;') + '</td>\
							<td style="border-right: 2px dotted #bbb;">' +  ((feature.properties['L_2019'] !== null  &&feature.properties['L_2019'] !== 'NA')?numberWithSpaces(Number(feature.properties['L_2019'])):'&mdash;') + '</td>\
							<td style = "font-weight: 700; color:'+ ((feature.properties['L_1999'] == 'NA'|| feature.properties['L_2009'] == 'NA'||(feature.properties['L_2009']==feature.properties['L_1999']))? 'black':((feature.properties['L_2009']-feature.properties['L_1999'])<0)?'red':'green')+'">'+((feature.properties['L_1999'] !== 'NA' &&feature.properties['L_2009'] !== 'NA')? (lengthToBlank2(feature.properties['L_2009']/feature.properties['L_1999']*100-100)+'%'):'&mdash;') + '</td>\
							<td style = "font-weight: 700; color:'+ ((feature.properties['L_2019'] == 'NA' || feature.properties['L_2009'] == 'NA'||(feature.properties['L_2019']==feature.properties['L_2009']))? 'black':((feature.properties['L_2019']-feature.properties['L_2009'])<0)?'red':'green')+'">'+((feature.properties['L_2019'] !== 'NA' &&feature.properties['L_2009'] !== 'NA')? (lengthToBlank2(feature.properties['L_2019']/feature.properties['L_2009']*100-100)+'%'):'&mdash;') + '</td>\
							<td style = "font-weight: 700; color:'+ ((feature.properties['L_1999'] == 'NA' ||feature.properties['L_2019'] == 'NA'||(feature.properties['L_2019']==feature.properties['L_1999']))? 'black':((feature.properties['L_2019']-feature.properties['L_1999'])<0)?'red':'green')+'">'+((feature.properties['L_1999'] !== 'NA' &&feature.properties['L_2019'] !== 'NA')? (lengthToBlank2(feature.properties['L_2019']/feature.properties['L_1999']*100-100)+'%'):'&mdash;') + '</td>\
						</tr>\
						<tr>\
							<td>'  + '<b>W wieku przedprodukcyjnym - 14&nbsp;lat i&nbsp;mniej: </b>'  + '</td>\
							<td>'+ ((feature.properties['D_D1999c'] !== null &&feature.properties['D_D1999c'] !== 100)? lengthToBlank1(feature.properties['D_D1999a'])+'%':'&mdash;') + '</td>\
							<td>' +  ((feature.properties['D_D2009c'] !== null  &&feature.properties['D_D2009c'] !== 100)?lengthToBlank1(feature.properties['D_D2009a'])+'%':'&mdash;') + '</td>\
							<td style="border-right: 2px dotted #bbb;">' +  ((feature.properties['D_D2019c'] !== null  &&feature.properties['D_D2019c'] !== 100)?lengthToBlank1(feature.properties['D_D2019a']) +'%':'&mdash;') + '</td>\
							<td style = "font-weight: 700; color:'+ ((feature.properties['D_D1999c'] == 100 || feature.properties['D_D2009c'] == 100)? 'black':((feature.properties['D_D2009a']-feature.properties['D_D1999a'])<0)?'red':'green')+'">'+((feature.properties['D_D1999c'] != 100 && feature.properties['D_D2009c'] != 100)?(lengthToBlank3(feature.properties['D_D2009a']-feature.properties['D_D1999a'])+' p.p.'):'&mdash;') + '</td>\
							<td style = "font-weight: 700; color:'+ ((feature.properties['D_D2019c'] == 100 || feature.properties['D_D2009c'] == 100)? 'black':((feature.properties['D_D2019a']-feature.properties['D_D2009a'])<0)?'red':'green')+'">'+((feature.properties['D_D2019c'] != 100 && feature.properties['D_D2009c'] != 100)?(lengthToBlank3(feature.properties['D_D2019a']-feature.properties['D_D2009a'])+' p.p.'):'&mdash;') + '</td>\
							<td style = "font-weight: 700; color:'+ ((feature.properties['D_D1999c'] == 100 ||feature.properties['D_D2019c'] == 100)? 'black':((feature.properties['D_D2019a']-feature.properties['D_D1999a'])<0)?'red':'green')+'">'+((feature.properties['D_D1999c'] != 100 && feature.properties['D_D2019c'] != 100)?(lengthToBlank3(feature.properties['D_D2019a']-feature.properties['D_D1999a'])+' p.p.'):'&mdash;') + '</td>\
						</tr>\
						<tr>\
							<td>'  + '<b>W wieku produkcyjnym:<br>15-59&nbsp;lat&nbsp;kobiety, 15-64&nbsp;lata&nbsp;mężczyźni: </b>'  + '</td> <td>'+ ((feature.properties['D_D1999c'] !== null &&feature.properties['D_D1999c'] !== 100)? lengthToBlank1(feature.properties['D_D1999b'])+'%':'&mdash;') + '</td><td>' +  ((feature.properties['D_D2009c'] !== null  &&feature.properties['D_D2009c'] !== 100)?lengthToBlank1(feature.properties['D_D2009b'])+'%':'&mdash;') + '</td><td style="border-right: 2px dotted #bbb;">' +  ((feature.properties['D_D2019c'] !== null  &&feature.properties['D_D2019c'] !== 100)?lengthToBlank1(feature.properties['D_D2019b']) +'%':'&mdash;') + '</td>\
							<td style = "font-weight: 700; color:'+ ((feature.properties['D_D1999c'] == 100 || feature.properties['D_D2009c'] == 100)? 'black':((feature.properties['D_D2009b']-feature.properties['D_D1999b'])<0)?'red':'green')+'">'+((feature.properties['D_D1999c'] != 100 && feature.properties['D_D2009c'] != 100)?(lengthToBlank3(feature.properties['D_D2009b']-feature.properties['D_D1999b'])+' p.p.'):'&mdash;') + '</td>\
							<td style = "font-weight: 700; color:'+ ((feature.properties['D_D2019c'] == 100 || feature.properties['D_D2009c'] == 100)? 'black':((feature.properties['D_D2019b']-feature.properties['D_D2009b'])<0)?'red':'green')+'">'+((feature.properties['D_D2019c'] != 100 && feature.properties['D_D2009c'] != 100)?(lengthToBlank3(feature.properties['D_D2019b']-feature.properties['D_D2009b'])+' p.p.'):'&mdash;') + '</td>\
							<td style = "font-weight: 700; color:'+ ((feature.properties['D_D1999c'] == 100 || feature.properties['D_D2019c'] == 100)? 'black':((feature.properties['D_D2019b']-feature.properties['D_D1999b'])<0)?'red':'green')+'">'+((feature.properties['D_D1999c'] != 100 && feature.properties['D_D2019c'] != 100)?(lengthToBlank3(feature.properties['D_D2019b']-feature.properties['D_D1999b'])+' p.p.'):'&mdash;') + '</td>\
						</tr>\
						<tr>\
							<td>'  + '<b>W&nbsp;wieku poprodukcyjnym: </b>' + '</td>\
							<td>' + ((feature.properties['D_D1999c'] !== null &&feature.properties['D_D1999c'] !== 100)? lengthToBlank1(feature.properties['D_D1999c'])+'%':'&mdash;') + '</td><td>' +  ((feature.properties['D_D2009c'] !== null  &&feature.properties['D_D2009c'] !== 100)?lengthToBlank1(feature.properties['D_D2009c'])+'%':'&mdash;') + '</td>\
							<td style="border-right: 2px dotted #bbb;">' +  ((feature.properties['D_D2019c'] !== null  &&feature.properties['D_D2019c'] !== 100)?lengthToBlank1(feature.properties['D_D2019c']) +'%':'&mdash;') + '</td>\
							<td style = "font-weight: 700; color:'+ ((feature.properties['D_D1999c'] == 100 || feature.properties['D_D2009c'] == 100)? 'black':((feature.properties['D_D2009c']-feature.properties['D_D1999c'])<0)?'red':'green')+'">'+((feature.properties['D_D1999c'] != 100 && feature.properties['D_D2009c'] != 100)?(lengthToBlank3(feature.properties['D_D2009c']-feature.properties['D_D1999c'])+' p.p.'):'&mdash;') + '</td>\
							<td style = "font-weight: 700; color:'+ ((feature.properties['D_D2019c'] == 100 || feature.properties['D_D2009c'] == 100)? 'black':((feature.properties['D_D2019c']-feature.properties['D_D2009c'])<0)?'red':'green')+'">'+((feature.properties['D_D2019c'] != 100 && feature.properties['D_D2009c'] != 100)?(lengthToBlank3(feature.properties['D_D2019c']-feature.properties['D_D2009c'])+' p.p.'):'&mdash;') + '</td>\
							<td style = "font-weight: 700; color:'+ ((feature.properties['D_D1999c'] == 100 || feature.properties['D_D2019c'] == 100)? 'black':((feature.properties['D_D2019c']-feature.properties['D_D1999c'])<0)?'red':'green')+'">'+((feature.properties['D_D1999c'] != 100 && feature.properties['D_D2019c'] != 100)?(lengthToBlank3(feature.properties['D_D2019c']-feature.properties['D_D1999c'])+' p.p.'):'&mdash;')+ '</td>\
						</tr>\
						<tr>\
							<td>'  + '<b>Kolor: </b>' + '</td>\
							<td><div style = "background-color: ' + ((feature.properties['D_D1999c'] !== 100)? feature.properties['D99rgb']:'rgba(0,0,0,0.0)')  + '; display: inline-block; padding: 12px; margin: 2px; opacity: 0.8;"></div></td>\
							<td><div style = "background-color: ' + ((feature.properties['D_D2009c'] !== 100)? feature.properties['D09rgb']:'rgba(0,0,0,0.0)')   + '; display: inline-block; padding: 12px; margin: 2px; opacity: 0.8;"></div></td>\
							<td style="border-right: 2px dotted #bbb;"><div style = "background-color: ' + ((feature.properties['D_D2019c'] !== 100)? feature.properties['D19rgb']:'rgba(0,0,0,0.0)')   + '; display: inline-block; padding: 12px; margin: 2px; opacity: 0.8;"></div></td>\
							<td><div style = "background-color: ' + ((feature.properties['D_D1999c'] !== 100 &&feature.properties['D_D2009c'] !== 100)? feature.properties['D09_99rgb']:'rgba(0,0,0,0.0)')  + '; display: inline-block; padding: 10px; margin: 2px; opacity: 0.8;"></div><div style = "background-color: ' + ((feature.properties['D_D1999c'] !== 100 &&feature.properties['D_D2009c'] !== 100)? feature.properties['D09_99crgb']:'rgba(0,0,0,0.0)')  + '; display: inline-block; padding: 10px; margin: 2px; opacity: 0.8;"></div></td>\
							<td><div style = "background-color: ' + ((feature.properties['D_D2019c'] !== 100 &&feature.properties['D_D2009c'] !== 100)? feature.properties['D19_09rgb']:'rgba(0,0,0,0.0)')   + '; display: inline-block; padding: 10px; margin: 2px; opacity: 0.8;"></div><div style = "background-color: ' + ((feature.properties['D_D2019c'] !== 100 &&feature.properties['D_D2009c'] !== 100)? feature.properties['D19_09crgb']:'rgba(0,0,0,0.0)')   + '; display: inline-block; padding: 10px; margin: 2px; opacity: 0.8;"></div></td>\
							<td><div style = "background-color: ' + ((feature.properties['D_D2019c'] !== 100 &&feature.properties['D_D1999c'] !== 100)? feature.properties['D19_99rgb']:'rgba(0,0,0,0.0)')   + '; display: inline-block; padding: 10px; margin: 2px; opacity: 0.8;"></div><div style = "background-color: ' + ((feature.properties['D_D2019c'] !== 100 &&feature.properties['D_D1999c'] !== 100)? feature.properties['D19_99crgb']:'rgba(0,0,0,0.0)')   + '; display: inline-block; padding: 10px; margin: 2px; opacity: 0.8;"></div></td>\
						</tr>';
			popupContent += tabc;
			popupContent += divclear;
			/*popupContent.push(tabc);
			popupContent.push(divclear);*/
			p.index = p.JPT_NAZWA_ + " | "+ p.JPT_KOD_JE;
            layer.bindPopup(popupContent/*.join("")*/, {maxHeight: 640/*, keepInView: true*/});
			layers[feature.properties.JPT_KOD_JE] = layer;
			licznik++;
        }
		function pop_Gminy_0(feature, layer) {
			layer.bindPopup(layers[feature.properties.JPT_KOD_JE]._popup._content, {maxHeight: 640});
		}


       var hash = new L.Hash(map);
	   
	   
        map.attributionControl.addAttribution('<a href="https://mapshaper.org/" target="_blank">mapshaper</a>');
        map.attributionControl.addAttribution('<a href="https://devexus.net/articles/how-to-create-simple-slider-with-jquery/" target="_blank">Simple slider</a>');
        map.attributionControl.addAttribution('<a href="https://github.com/tomchadwin/qgis2web" target="_blank">qgis2web</a>');
		map.attributionControl.addAttribution('<a href="https://github.com/jschoeley/tricolore" target="_blank">tricolore</a>');
		map.attributionControl.addAttribution('<a href="http://owumaro.github.io/text-stroke-generator/" target="_blank">CSS text-stroke generator</a>');
		map.attributionControl.addAttribution('<a href="https://maketext.io/" target="_blank">Maketext.io</a>');
		map.attributionControl.addAttribution('<a href="https://bdl.stat.gov.pl/BDL/start" target="_blank">GUS - Bank Danych Lokalnych</a>');
		
        //basemap0.addTo(map);
		//L.control.locate().addTo(map);
		
		/*const MultipleResultsLeafletSearch = L.Control.Search.extend({
		  _defaultFilterData: (text, records) => records,
		  _defaultFormatData: json => json,
		  _createTip: function (i, obj) {
			return new L.Control.Search()._createTip.call(this, obj.title, obj.loc);
		  },
		});*/
		console.log(json_Demografia.features[0].properties.index)
       	var searchControl = new L.Control.Search({
			layer: layer_1999,
			propertyName: 'index',
			marker: false,
			textPlaceholder: 'Wpisz nazwę gminy...',
			/*filterData: (text, records) => records,*/
			buildTip: function(text, val) {
					  var p = val.layer.feature.properties;
					  var tip = p.JPT_NAZWA_;
					  var vip = p.JPT_KOD_JE;
					  return '<a href="#" class=""><div style="float:left; width: 176px;"><span style=" font-size: 12px;">'+ tip +'</span>, <span style=" font-size: 11px;"><i>' +(vip.substring(6,7)!=="1"?'gmina':'miasto')+ '</i></span></div><div style="float:left; font-size: 9px; padding-left: 4px;">' + json_Powiaty_Simplified_1.getFeaturesByProperty('JPT_KOD_JE', val.layer.feature.properties['Powiat'])[0].properties.JPT_NAZWA_+'<br>województwo ' +  json_Granicewojewdztw_2.getFeaturesByProperty('Wojewod', val.layer.feature.properties['Wojewod'])[0].properties.JPT_NAZWA_ + '</div><div style="clear:both;"></div></a>';
			},
			moveToLocation: function(latlng, title, map) {
				map.fitBounds( latlng.layer.getBounds() );
				var zoom = map.getBoundsZoom(latlng.layer.getBounds());
				map.setView(latlng, zoom); // access the zoom
			}
		});
		//searchControl.onAdd(map);
		
		searchControl.on('search:locationfound', function(e) {
			map.closePopup();
			//console.log('search:locationfound', );
			layer_1999.eachLayer(function(layer) {	//restore feature color
				layer_1999.resetStyle(layer);
			});
			//map.removeLayer(this._markerSearch)
			//e.layer.bringToFront();
			e.layer.setStyle({color: 'rgba(255,255,255,0.5)', weight: '8', /*dashArray: '16, 16',*/  lineCap: 'round', lineJoin: 'round',fillColor: 'rgba(255,0,0,0.9)',});
			e.layer.bringToFront();
			resetLabels([layer_Powiaty_Simplified_1]);
			map.getPane('labels').style.display = 'inline-block';
			/*map.getPane('labels').style['text-align'] = 'center';*/
			
			if(e.layer._popup)
				e.layer.openPopup();
				//https://bdot10k.geoportal.gov.pl/#showLayersList&1618582473368
		}).on('search:collapsed', function(e) {

				layer_1999.eachLayer(function(layer) {	//restore feature color
					layer_1999.resetStyle(layer);
				});	
		});
		map.addControl( searchControl );
		
		//searchControl._input.value = "Racławice | 1208062";
		//searchControl._input.style ="display: block; max-width: 1283px; outline: medium none;";
		//searchControl._createCancel('x', 'search-cancel');
		//console.log(searchControl._input);
		//searchControl._handleSend();
		
		/*var loc = searchControl._getLocation("Pniewy | 1406092");
		console.log(loc);
		searchControl.options.moveToLocation = function(loc, "Pniewy | 1406092", map) {
				//map.fitBounds( latlng.layer.getBounds() );
				var zoom = map.getBoundsZoom(loc.layer.getBounds());
				map.setView(loc, zoom); // access the zoom
			}*/
		
		/*searchControl.showLocation(loc,"Pniewy | 1406092");*/
        
        //bounds_group.addLayer(layer_Okregi_0);
      //map.addLayer(layer_Okregi_0);
        //setBounds();
        var i = 0;
		var a = map.getZoom();
		//var area = 0;
		//var pointLayer;
        
		
		var baseMaps = {
			/*'<img src="legend/Granicewojewdztw_2.png" /> Granice województw': Wojewod,*/
			'1999': layer_1999,
			'2009': layer_2009,
			'2019': layer_2019,
			'1999 -> 2009': layer_09_99,
			'2009 -> 2019': layer_19_09,
			'1999 -> 2019': layer_19_99,
			'1999 -> 2009 ': layer_09_99c,
			'2009 -> 2019 ': layer_19_09c,
			'1999 -> 2019 ': layer_19_99c
		};
		/*L.featureGroup([baseMaps])
			.bindPopup('Hello world!')
			.on('click', function() { alert('Clicked on a group!'); })
			.addTo(map);*/
		var bestMaps = {};
		
		/*L.control.layers(baseMaps,null,{collapsed:false}).addTo(map);*/
		
		/*map.removeLayer(layer_2009);
		map.removeLayer(layer_2019);*/
		
		/*map.on('dragend',function() {
			controlLoader.show();
			setTimeout(function() {
				controlLoader.hide();
			},3000);
		});*/
		
		var layerControl = L.control.layers(baseMaps,{'<span class = "granice"><img src="legend/Granicewojewdztw_2.png" /> Granice województw</span>': Wojewod,'<span class = "granice"><img src="legend/Powiaty_Simplified_1.png" /> Granice powiatów</span>': Powiaty,},{collapsed:true}).addTo(map);
		var layerControl1 = L.control.layers(bestMaps,null,{collapsed:true}).addTo(map);
		/*var layerControl2 = L.control.layers(bestMaps,null,{collapsed:true}).addTo(map);*/
		var KO_proc = 27.4;
		$('.leaflet-control-layers-toggle:eq( 0 )').html('<div style="background-image: linear-gradient(to right, #c4d3ae 0%, #b8e186 51%, #c4d3ae 100%); border-radius: 8px;box-shadow: 0 0 20px #888; border: 2px solid #fff; text-shadow: -1px 0 #b8e186, 0 1px #b8e186, 1px 0 #b8e186, 0 -1px #b8e186;">Wybierz mapę...</div>');
		$('.leaflet-control-layers-toggle:eq( 1 )').html('<div style="background-image: linear-gradient(to right, #c4d3ae 0%, #b8e186 51%, #c4d3ae 100%); border-radius: 8px;box-shadow: 0 0 20px #888; border: 2px solid #fff; text-shadow: -1px 0 #b8e186, 0 1px #b8e186, 1px 0 #b8e186, 0 -1px #b8e186;">Podsumowanie</div>');
		//$('.leaflet-control-layers label:eq(2)').append('<div style="margin-bottom: 8px;"></div>');
		//$('.leaflet-control-layers label span').slice(3,6).css("background-image","linear-gradient(to right, #e6f5b0 0%, #f7f7d7 51%, #e6f5b0 100%)").addClass('leaflet-control-layers-middle');
		$('.leaflet-control-layers-base label div input').slice(3,6).addClass('leaflet-control-layers-middle-input');
		$('.leaflet-control-layers-base label:eq( 0 ) div input').prop("checked", true);
		$('.leaflet-control-layers-middle-input').next().css("background-image","linear-gradient(to right, #e6f5b0 0%, #f7f7d7 51%, #e6f5b0 100%)");
		//$('.leaflet-control-layers label:eq(0)').before('<div style="margin:  8px 0px 0px 0px; font-family: \'Roboto\', sans-serif ;"><div style = "text-align:center; font-size: 16px; margin-bottom: 16px; font-weight: 900; font-color: #000; line-height: 1.25; text-shadow: rgba(240,240,240,0.1) 2px 0px 0px, rgba(240,240,240,0.1) 1.75px 0.966667px 0px, rgba(240,240,240,0.1) 1.08333px 1.68333px 0px, rgba(240,240,240,0.1) 0.133333px 2px 0px, rgba(240,240,240,0.1) -0.833333px 1.81667px 0px, rgba(240,240,240,0.1) -1.6px 1.2px 0px, rgba(240,240,240,0.1) -1.98333px 0.283333px 0px, rgba(240,240,240,0.1) -1.86667px -0.7px 0px, rgba(240,240,240,0.1) -1.3px -1.51667px 0px, rgba(240,240,240,0.1) -0.416667px -1.95px 0px, rgba(240,240,240,0.1) 0.566667px -1.91667px 0px, rgba(240,240,240,0.1) 1.41667px -1.41667px 0px, rgba(240,240,240,0.1) 1.91667px -0.566667px 0px;">Ludność w wieku przedprodukcyjnym<br>(14 lat i mniej),<br>produkcyjnym i poprodukcyjnym:</div></div><p style= "margin: -4px; padding: 0px 0px 0px 8px;">Struktura wiekowa:</p>');
		$('.leaflet-control-layers-base:eq(0)').before('<div style="margin:  8px 0px 0px 0px; font-family: \'Roboto\', sans-serif ;"><div style = "text-align:center; font-size: 16px; margin-bottom: 16px; font-weight: 900; font-color: #000; line-height: 1.25; text-shadow: rgba(240,240,240,0.1) 2px 0px 0px, rgba(240,240,240,0.1) 1.75px 0.966667px 0px, rgba(240,240,240,0.1) 1.08333px 1.68333px 0px, rgba(240,240,240,0.1) 0.133333px 2px 0px, rgba(240,240,240,0.1) -0.833333px 1.81667px 0px, rgba(240,240,240,0.1) -1.6px 1.2px 0px, rgba(240,240,240,0.1) -1.98333px 0.283333px 0px, rgba(240,240,240,0.1) -1.86667px -0.7px 0px, rgba(240,240,240,0.1) -1.3px -1.51667px 0px, rgba(240,240,240,0.1) -0.416667px -1.95px 0px, rgba(240,240,240,0.1) 0.566667px -1.91667px 0px, rgba(240,240,240,0.1) 1.41667px -1.41667px 0px, rgba(240,240,240,0.1) 1.91667px -0.566667px 0px;">Ludność w wieku przedprodukcyjnym<br>(14 lat i mniej),<br>produkcyjnym i poprodukcyjnym:</div></div>');
		$('.leaflet-control-layers label:eq(0)').before('<p class= "category">Struktura wiekowa<br>(wartość średnia jako punkt odniesienia):</p>');
		$('<p class= "category">Zmiana struktury wiekowej<br>(wartość średnia jako punkt odniesienia):</p>').insertAfter('.leaflet-control-layers label:eq(2)');
		$('<p class= "category">Zmiana struktury wiekowej<br>(zero jako punkt odniesienia):</p>').insertAfter('.leaflet-control-layers label:eq(5)');
		/*$('.leaflet-control-layers-middle:checked').next().css("background-image","linear-gradient(to right, #276400 0%, #4d9201 51%, #276400 100%)");*/
		
		/*if ($('input[type="radio"]:checked').next().hasClass('leaflet-control-layers-middle')){
			$('.leaflet-control-layers-middle').css("background-image","linear-gradient(to right, #276400 0%, #4d9201 51%, #276400 100%)");
			console.log("Racja, ma!!!");
		}*/
		//$('.leaflet-control-layers label:eq(5)').append('<div style="margin-bottom: 8px;"></div>');
		//$('.leaflet-control-layers label:eq(8)').append('<div style="margin-bottom: 12px;"></div>');
		$('<div style="margin-bottom: 12px;"></div>').insertAfter('.leaflet-control-layers label:eq(8)');
	
		/*$('.leaflet-right:eq( 0 )').append('<div style="background-color: #b8e186;"></div>');*/
		//leaflet-control-layers-list
		//$('.leaflet-container .leaflet-control-attribution').css("background", "rgba(192, 255, 192, 0.5)");
		$('.leaflet-control-layers-list:eq( 0 )').append('<div style="margin:  32px 0px 0px 0px;"></div>');
	
		
		//console.log(map.getPane('label21'));
		/*var paragraphs = document.querySelectorAll('div'), i;
		for (i = 0; i < paragraphs.length; ++i) {
		  paragraphs[i].style.color = "green";
		  console.log(paragraphs[i].nodeName);
		}*/
		
		$('.leaflet-control-layers-list:eq( 1 )').html('<div style="margin:  8px 0px 0px 0px;  z-index: 850; background-image: linear-gradient(to right, #e6f5d0 0%, #f7f7f7 51%, #e6f5d0 100%); "><h4 style="text-align: center; margin-left: 16px; line-height: 1.25;">Struktura wiekowa mieszkańców Polski w&nbsp;latach 1999, 2009 i 2019:</h4>\
			<table class = "tabela" id="Podsumowanie" style="line-height: 1.4;">\
					<thead>\
						<tr style="background: none;">\
							<th style="border-right: 2px solid #eee; border-top-left-radius: 32px;"></th>\
							<th><b>1999</b></th>\
							<th><b>2009</b></th>\
							<th style="border-right: 2px solid #eee;"><b>2019</b></th>\
							<th><b>1999->2009</b></th>\
							<th><b>2009->2019</b></th>\
							<th>1999->2019</b></th>\
						</tr>\
					</thead>\
					<tbody>\
						<tr class="divider">\
							<td>'  + '<b>Liczba mieszkańców: </b>'  + '</td>\
							<td>'+ numberWithSpaces(38263303)+ '</td>\
							<td>'+ numberWithSpaces(38167329)+ '</td>\
							<td style="border-right: 2px dotted #bbb;">'+ numberWithSpaces(38382576)+ '</td>\
							<td style = "font-weight: 700; color:'+ ((38167329-38263303<0)?'red':'green')+'">'+(lengthToBlank3(38167329/38263303*100-100)+'%') + '</td>\
							<td style = "font-weight: 700; color:'+ ((38382576-38167329<0)?'red':'green')+'">'+(lengthToBlank3(38382576/38167329*100-100)+'%') + '</td>\
							<td style = "font-weight: 700; color:'+ ((38382576-38263303<0)?'red':'green')+'">'+(lengthToBlank3(38382576/38263303*100-100)+'%') + '</td>\
						</tr>\
						<tr>\
							<td>'  + '<b>W wieku przedprodukcyjnym - 14&nbsp;lat i&nbsp;mniej: </b>'  + '</td>\
							<td>'+ lengthToBlank1(19.815)+ '%</td>\
							<td>'+ lengthToBlank1(15.151)+ '%</td>\
							<td style="border-right: 2px dotted #bbb;">'+ lengthToBlank1(15.341)+ '%</td>\
							<td style = "font-weight: 700; color:'+ ((15.151-19.815<0)?'red':'green')+'">'+(lengthToBlank3(15.151-19.815)+' p.p.') + '</td>\
							<td style = "font-weight: 700; color:'+ ((15.341-15.151<0)?'red':'green')+'">'+(lengthToBlank3(15.341-15.151)+' p.p.') + '</td>\
							<td style = "font-weight: 700; color:'+ ((15.341-19.815<0)?'red':'green')+'">'+(lengthToBlank3(15.341-19.815)+' p.p.') + '</td>\
						</tr>\
						<tr>\
							<td>'  + '<b>W wieku produkcyjnym:<br>15-59&nbsp;lat&nbsp;kobiety, 15-64&nbsp;lata&nbsp;mężczyźni: </b>'  + '</td> \
							<td>'+ lengthToBlank1(65.57)+ '%</td>\
							<td>'+ lengthToBlank1(68.312)+ '%</td>\
							<td style="border-right: 2px dotted #bbb;">'+ lengthToBlank1(62.754)+ '%</td>\
							<td style = "font-weight: 700; color:'+ ((68.312-65.57<0)?'red':'green')+'">'+(lengthToBlank3(68.312-65.57)+' p.p.') + '</td>\
							<td style = "font-weight: 700; color:'+ ((62.754-68.312<0)?'red':'green')+'">'+(lengthToBlank3(62.754-68.312)+' p.p.') + '</td>\
							<td style = "font-weight: 700; color:'+ ((62.754-65.57<0)?'red':'green')+'">'+(lengthToBlank3(62.754-65.57)+' p.p.') + '</td>\
						</tr>\
						<tr>\
							<td>'  + '<b>W&nbsp;wieku poprodukcyjnym: </b>' + '</td>\
							<td>'+ lengthToBlank1(14.615)+ '%</td>\
							<td>'+ lengthToBlank1(16.537)+ '%</td>\
							<td style="border-right: 2px dotted #bbb;">'+ lengthToBlank1(21.905)+ '%</td>\
							<td style = "font-weight: 700; color:'+ ((16.537-14.615<0)?'red':'green')+'">'+(lengthToBlank3(16.537-14.615)+' p.p.') + '</td>\
							<td style = "font-weight: 700; color:'+ ((21.905-16.537<0)?'red':'green')+'">'+(lengthToBlank3(21.905-16.537)+' p.p.') + '</td>\
							<td style = "font-weight: 700; color:'+ ((21.905-14.615<0)?'red':'green')+'">'+(lengthToBlank3(21.905-14.615)+' p.p.') + '</td>\
						</tr>\
					</tbody>\
				</table>\
				<p class="category"><i>Opracowanie własne na podstawie danych GUS.</i></p>\
		</div>');

		L.Control.Watermark = L.Control.extend({
			onAdd: function(map) {
				var img = L.DomUtil.create('img');

				img.src = './images/1999.png';
				img.style.width = '200px';
				img.style.opacity= '0.9';
				//margin-bottom: -60px;
				img.style.margin= '0px 0px 0px 0px';

				return img;
			},

			onRemove: function(map) {
				// Nothing to do here
			}
		});

		L.control.watermark = function(opts) {
			return new L.Control.Watermark(opts);
		}

		L.control.watermark({ position: 'bottomleft' }).addTo(map);
		$('.leaflet-bottom:eq(0)').css('filter', 'drop-shadow(5px 5px 10px #ccc)');
		
		/*$('.leaflet-bottom:eq( 1 )').append('<div style="clear: both;"></div>');*/
				
		var populationLegend = L.control({position: 'bottomright'});
		var populationChangeLegend = L.control({position: 'bottomright'});

		populationLegend.onAdd = function (map) {
			var div = L.DomUtil.create('div', 'info legend');
			div.innerHTML +=
			'<div style="margin:  8px 0px 0px 0px; font-family: \'Roboto\', sans-serif ;"><div style = "text-align:center; font-size: 16px; margin-bottom: 16px; font-weight: 900">Ludność w wieku przedprodukcyjnym (14 lat i mniej),<br>produkcyjnym i poprodukcyjnym:</div><div style = "margin-left: auto; margin-right: auto; opacity: 1.0;"><img src="legend/L1999.png" alt ="Legenda"  style="width:400px; height: 400px"/></div></div>';
			return div;
		};

		populationChangeLegend.onAdd = function (map) {
			var div = L.DomUtil.create('div', 'info legend');
			div.innerHTML +=
			'<img src="change_legend.png" alt="legendy" width="134" height="147">';
			return div;
		};

		// Add this one (only) for now, as the Population layer is on by default
		/*populationLegend.addTo(map);*/
		
		layer_Powiaty_Simplified_1.eachLayer(function(layer) {
            var context = {
                feature: layer.feature,
                variables: {}
            };
            layer.bindTooltip((label_Powiaty_Simplified_1_eval_expression(context) !== null?String('<div style="color: #fff; font-size: 8pt; font-weight: bold; box-shadow: 0 0 15px rgba(64,64,64,0.25); text-align: center; text-shadow: rgba(80,80,80,0.75) 2px 0px 0px, rgba(80,80,80,0.75) 1.75px 0.966667px 0px, rgba(80,80,80,0.75) 1.08333px 1.68333px 0px, rgba(80,80,80,0.75) 0.133333px 2px 0px, rgba(80,80,80,0.75) -0.833333px 1.81667px 0px, rgba(80,80,80,0.75) -1.6px 1.2px 0px, rgba(80,80,80,0.75) -1.98333px 0.283333px 0px, rgba(80,80,80,0.75) -1.86667px -0.7px 0px, rgba(80,80,80,0.75) -1.3px -1.51667px 0px, rgba(80,80,80,0.75) -0.416667px -1.95px 0px, rgba(80,80,80,0.75) 0.566667px -1.91667px 0px, rgba(80,80,80,0.75) 1.41667px -1.41667px 0px, rgba(80,80,80,0.75) 1.91667px -0.566667px 0px; font-family: \'MS Shell Dlg 2\', sans-serif">' + label_Powiaty_Simplified_1_eval_expression(context)) + '</div>':''), {pane: 'labels', permanent: true, offset: [0, 0], className: 'css_Powiaty_Simplified_1', direction:"center", opacity:1.0});
            labels.push(layer);
            totalMarkers += 1;
            layer.added = true;
            //addLabel(layer, i);
            i++;
        });
		//https://devexus.net/articles/how-to-create-simple-slider-with-jquery/
		function insertSlider(year, type, pages){
			var text;
			var items = [];
			items.push('<div class="slides-container">');
			var plots = [12,13,21,23,31,32];
			pages = pages + 0;
			for (i=0; i<pages; i++){
				if ((i==0)&&(pages>6)){
					text='<div class="slide"><img src="legend/L'+year+'9'+type+'.png" alt="Slider img '+(i+1)+'" ></div>';
					//text = '<div class="slide"><img src="legend/L90_12_a.PNG" alt="Slider img 1" ></div>';
					//console.log('aaa');
				}else{
					text='<div class="slide"><img src="legend/L'+year+'_'+plots[6-(pages-i)]+type+'.PNG" alt="Slider img '+(i+1)+'" ></div>';
					//text = '<div class="slide"><img src="legend/L90_12_b.PNG" alt="Slider img 1" ></div>';
					//console.log('bbb');
				}
				//text = '<div class="slide"><img src="legend/L90_12_b.PNG" alt="Slider img 1" ></div>';
				//text='<div class="slide"><img src="legend/L'+year+'9.png" alt="Slider img '+(i+1)+'" ></div>';
				items.push(text);
			}
			items.push('</div>\
							<div class="arrows">\
								<a class="prev" href="#"><</i></a>\
								<a class="next" href="#">></a>\
							</div>\
							<div class="pager">1 / ');
			items.push(pages);
			items.push('</div>');
			return items.join("");
		}
		//$('.leaflet-control-layers-list:eq( 0 )').append('<div class = "triangle" style = "margin-left: auto; margin-right: auto; opacity: 1.0;"><img src="legend/L99.png" alt ="Legenda"  style="margin-left: auto; margin-right: auto; width:320px; height: 320px; border-radius: 6px; display: block;"/></div>');
		/*$('.leaflet-control-layers-list:eq( 0 )').append('\
		<div id="slider">\
			<div class="slides-container">\
				<div class="slide"><img src="legend/L99.png" alt="Slider img 1" ></div>\
				<div class="slide"><img src="legend/L9_12.PNG" alt="Slider img 2" ></div>\
				<div class="slide"><img src="legend/L9_13.PNG" alt="Slider img 3" ></div>\
				<div class="slide"><img src="legend/L9_21.PNG" alt="Slider img 4" ></div>\
				<div class="slide"><img src="legend/L9_23.PNG" alt="Slider img 5" ></div>\
				<div class="slide"><img src="legend/L9_31.PNG" alt="Slider img 6" ></div>\
				<div class="slide"><img src="legend/L9_32.PNG" alt="Slider img 7" ></div>\
			</div>\
			\
			<div class="arrows">\
				<a class="prev" href="#"><</i></a>\
				<a class="next" href="#">></a>\
			</div>\
			\
			<div class="pager">\
				1 / 7\
			</div>\
			\
		</div>');*/
		var _slider = insertSlider(9, "", 7);
		$('.leaflet-control-layers-list:eq( 0 )').append('<div id="slider">'+_slider+'</div>');
	
		function dxSimpleSlider(element) {
			//element = '#dx-slider';
			// Get parent element
			var $this = $(element);

			// Slides container
			var slidesCont = $this.children('.slides-container');
			// Get all slides
			var slides = slidesCont.children('.slide');

			// Get pager div
			var pager = $this.children('.pager');

			// Get Previous / Next links
			var arrowsCont = $this.children('.arrows');
			var prevSlide = arrowsCont.children('.prev');
			var nextSlide = arrowsCont.children('.next');

			// Total slides count
			var slidesCount = slides.length;

			// Set currentSlide to first child
			var currentSlide = slides.first();
			var currentSlideIndex = 1;

			//var autoPlay = null;

			// Hide all slides except first and add active class to first
			slides.not(':first').css('display', 'none');
			currentSlide.addClass('active');

			// Function responsible for fading to next slide
			function fadeNext() {
				currentSlide.removeClass('active').fadeOut(700);

				if(currentSlideIndex == slidesCount) {
					currentSlide = slides.first();
					currentSlide.delay(500).addClass('active').fadeIn(700);
					currentSlideIndex = 1;
				} else {
					currentSlideIndex++;
					currentSlide = currentSlide.next();
					currentSlide.delay(500).addClass('active').fadeIn(700);
				}

				pager.text(currentSlideIndex+' / '+slidesCount);
			}

			// Function responsible for fading to previous slide
			function fadePrev() {
				currentSlide.removeClass('active').fadeOut(700);

				if(currentSlideIndex == 1) {
					currentSlide = slides.last();
					currentSlide.delay(500).addClass('active').fadeIn();
					currentSlideIndex = slidesCount;
				} else {
					currentSlideIndex--;
					currentSlide = currentSlide.prev();
					currentSlide.delay(500).addClass('active').fadeIn(700);
				}

				pager.text(currentSlideIndex+' / '+slidesCount);
			}

			// Function that starts the autoplay and resets it in case user navigated (clicked prev or next)
			/*function AutoPlay() {
				clearInterval(autoPlay);

				if(auto == true)
					autoPlay = setInterval(function() {fadeNext()}, pause);
			}*/

			// Detect if user clicked on arrow for next slide and fade next slide if it did
			$(nextSlide).click(function(e) {
				e.preventDefault();
				fadeNext();
				//AutoPlay();
			});

			// Detect if user clicked on arrow for previous slide and fade previous slide if it did
			$(prevSlide).click(function(e) {
				e.preventDefault();
				fadePrev();
				//AutoPlay();
			});

			// Start autoplay if auto is set to true
			//AutoPlay();

		}

		var slider = $(function() {
			dxSimpleSlider('#slider');
		});
		map.getPane('labels').style.display = 'none';
		var lastZoom;
		var tooltipThreshold = 8;
		map.on('zoomend', function() {
			resetLabels([layer_Powiaty_Simplified_1]);
			var zoom = map.getZoom();
			if (zoom < tooltipThreshold && (!lastZoom || lastZoom >= tooltipThreshold)) {
				map.getPane('labels').style.display = 'none';
			} else if (zoom >= tooltipThreshold && (!lastZoom || lastZoom < tooltipThreshold)) { 
				map.getPane('labels').style.display = 'inline-block';
				map.getPane('labels').style['text-align'] = 'center';
			}
			lastZoom = zoom;
		});
		
		console.log(licznik);
		console.log(layer_1999._layers);
		/*function wypisz(eLayer) {
			if (eLayer.name === '1999') {
				console.log(eLayer.layer[0]);
			}
		}
		wypisz(layer_1999);*/
		/*for (i=0; i< json_Demografia.features.length; i++) console.log(json_Demografia.features[i].properties);*/

		map.on('baselayerchange', function (eventLayer) {
			/*console.log(eventLayer.name);*/
			// Switch to the Population legend...
			layer_code = eventLayer.layer._leaflet_id;
			/*console.log(layer_code); 
			console.log(eventLayer.layer);*/
			if (eventLayer.name === '1999') {
				l1 = eventLayer.layer._leaflet_id;
				$('.leaflet-bottom:eq( 0 )').html('<img class="leaflet-control" src="./images/1999.png" style="width: 200px; opacity: 0.9; margin-bottom: 0px;">');
				/*$('#slider').html('\
					<div class="slides-container">\
						<div class="slide"><img src="legend/L99.png" alt="Slider img 1" ></div>\
						<div class="slide"><img src="legend/L9_12.PNG" alt="Slider img 2" ></div>\
						<div class="slide"><img src="legend/L9_13.PNG" alt="Slider img 3" ></div>\
						<div class="slide"><img src="legend/L9_21.PNG" alt="Slider img 4" ></div>\
						<div class="slide"><img src="legend/L9_23.PNG" alt="Slider img 5" ></div>\
						<div class="slide"><img src="legend/L9_31.PNG" alt="Slider img 6" ></div>\
						<div class="slide"><img src="legend/L9_32.PNG" alt="Slider img 7" ></div>\
					</div>\
					\
					<div class="arrows">\
						<a class="prev" href="#"><</i></a>\
						<a class="next" href="#">></a>\
					</div>\
					\
					<div class="pager">\
						1 / 7\
					</div>');*/
					_slider = insertSlider(9, "", 7);
					$('#slider').html(_slider);
				$(function() {
					dxSimpleSlider('#slider');
				});
				var sl = $('#dx-slider').children('.slides-container').children('.slide').length;
				var sf= $('#dx-slider').children('.slides-container').children('.slide').first();
				$('#dx-slider').children('.pager').text('1 / '+sl);
				searchControl._layer = layer_1999;
				searchControl.on('search:locationfound', function(e) {
				
					//console.log('search:locationfound', );
					layer_1999.eachLayer(function(layer) {	//restore feature color
						layer_1999.resetStyle(layer);
					});
					//map.removeLayer(this._markerSearch)
					e.layer.setStyle({color: 'rgba(255,255,255,0.5)', weight: '8', /*dashArray: '16, 16',*/  lineCap: 'round', lineJoin: 'round',fillColor: 'rgba(255,0,0,0.9)',});
					e.layer.bringToFront();
					map.getPane('labels').style.display = 'inline-block';
					map.getPane('labels').style['text-align'] = 'center';
					/*if(e.layer._popup)
						e.layer.openPopup();*/
						//https://bdot10k.geoportal.gov.pl/#showLayersList&1618582473368
				}).on('search:collapsed', function(e) {

						layer_1999.eachLayer(function(layer) {	//restore feature color
							layer_1999.resetStyle(layer);
						});	
				});
				/*'1999 -> 2009': layer_09_99,
				'2009 -> 2019': layer_19_09,
				'1999 -> 2019': layer_19_99,
				'1999 -> 2009 (wartości bezwzględne)': layer_09_99c,
				'2009 -> 2019 (wartości bezwzględne)': layer_19_09c,
				'1999 -> 2019 (wartości bezwzględne)': layer_19_99c*/
			} else if (eventLayer.name === '2009') {
				l2 = eventLayer.layer._leaflet_id;
				$('.leaflet-bottom:eq( 0 )').html('<img class="leaflet-control" src="./images/2009.png" style="width: 200px; opacity: 0.9; margin-bottom: 0px;">');
				/*$('#slider').html('\
					<div class="slides-container">\
						<div class="slide"><img src="legend/L09.png" alt="Slider img 1" ></div>\
						<div class="slide"><img src="legend/L0_12.PNG" alt="Slider img 2" ></div>\
						<div class="slide"><img src="legend/L0_13.PNG" alt="Slider img 3" ></div>\
						<div class="slide"><img src="legend/L0_21.PNG" alt="Slider img 4" ></div>\
						<div class="slide"><img src="legend/L0_23.PNG" alt="Slider img 5" ></div>\
						<div class="slide"><img src="legend/L0_31.PNG" alt="Slider img 6" ></div>\
						<div class="slide"><img src="legend/L0_32.PNG" alt="Slider img 7" ></div>\
					</div>\
					<div class="arrows">\
						<a class="prev" href="#"><</i></a>\
						<a class="next" href="#">></a>\
					</div>\
					\
					<div class="pager">\
						1 / 7\
					</div>');*/
				_slider = insertSlider(0, "", 7);
				$('#slider').html(_slider);
				$(function() {
					dxSimpleSlider('#slider');
				});
				searchControl._layer = layer_2009;
				searchControl.on('search:locationfound', function(e) {
				
					//console.log('search:locationfound', );
					layer_2009.eachLayer(function(layer) {	//restore feature color
						layer_2009.resetStyle(layer);
					});
					//map.removeLayer(this._markerSearch)
					e.layer.setStyle({color: 'rgba(255,255,255,0.5)', weight: '8', /*dashArray: '16, 16',*/  lineCap: 'round', lineJoin: 'round',fillColor: 'rgba(255,0,0,0.9)',});
					e.layer.bringToFront();
					map.getPane('labels').style.display = 'inline-block';
					map.getPane('labels').style['text-align'] = 'center';
					/*if(e.layer._popup)
						e.layer.openPopup();*/
						//https://bdot10k.geoportal.gov.pl/#showLayersList&1618582473368
				}).on('search:collapsed', function(e) {

						layer_2009.eachLayer(function(layer) {	//restore feature color
							layer_2009.resetStyle(layer);
						});	
				});
			} else  if (eventLayer.name === '2019') { 
				l3 = eventLayer.layer._leaflet_id;
				$('.leaflet-bottom:eq( 0 )').html('<img class="leaflet-control" src="./images/2019.png" style="width: 200px; opacity: 0.9; margin-bottom: 0px;">');
				/*$('#slider').html('\
					<div class="slides-container">\
						<div class="slide"><img src="legend/L19.png" alt="Slider img 1" ></div>\
						<div class="slide"><img src="legend/L1_12.PNG" alt="Slider img 2" ></div>\
						<div class="slide"><img src="legend/L1_13.PNG" alt="Slider img 3" ></div>\
						<div class="slide"><img src="legend/L1_21.PNG" alt="Slider img 4" ></div>\
						<div class="slide"><img src="legend/L1_23.PNG" alt="Slider img 5" ></div>\
						<div class="slide"><img src="legend/L1_31.PNG" alt="Slider img 6" ></div>\
						<div class="slide"><img src="legend/L1_32.PNG" alt="Slider img 7" ></div>\
					</div>\
					<div class="arrows">\
						<a class="prev" href="#"><</i></a>\
						<a class="next" href="#">></a>\
					</div>\
					\
					<div class="pager">\
						1 / 7\
					</div>');*/
				_slider = insertSlider(1, "", 7);
				$('#slider').html(_slider);
				$(function() {
					dxSimpleSlider('#slider');
				});
				searchControl._layer = layer_2019;
				searchControl.on('search:locationfound', function(e) {
				
					//console.log('search:locationfound', );
					layer_2019.eachLayer(function(layer) {	//restore feature color
						layer_2019.resetStyle(layer);
					});
					//map.removeLayer(this._markerSearch)
					e.layer.setStyle({color: 'rgba(255,255,255,0.5)', weight: '8', lineCap: 'round', lineJoin: 'round',fillColor: 'rgba(255,0,0,0.9)',});
					e.layer.bringToFront();
					map.getPane('labels').style.display = 'inline-block';
					map.getPane('labels').style['text-align'] = 'center';
					/*if(e.layer._popup)
						e.layer.openPopup();*/
						//https://bdot10k.geoportal.gov.pl/#showLayersList&1618582473368
				}).on('search:collapsed', function(e) {

						layer_2019.eachLayer(function(layer) {	//restore feature color
							layer_2019.resetStyle(layer);
						});	
				});
			}else  if (eventLayer.name === '1999 -> 2009') { 
				l4 = eventLayer.layer._leaflet_id;
				$('.leaflet-bottom:eq( 0 )').html('<img class="leaflet-control" src="./images/1999 --_ 2009.png" style="width: 400px; opacity: 0.9; margin-bottom: 0px;">');
				/*$('#slider').html('\
					<div class="slides-container">\
						<div class="slide"><img src="legend/L90_12_b.PNG" alt="Slider img 1" ></div>\
						<div class="slide"><img src="legend/L90_13_b.PNG" alt="Slider img 2" ></div>\
						<div class="slide"><img src="legend/L90_21_b.PNG" alt="Slider img 3" ></div>\
						<div class="slide"><img src="legend/L90_23_b.PNG" alt="Slider img 4" ></div>\
						<div class="slide"><img src="legend/L90_31_b.PNG" alt="Slider img 5" ></div>\
						<div class="slide"><img src="legend/L90_32_b.PNG" alt="Slider img 6" ></div>\
					</div>\
					<div class="arrows">\
						<a class="prev" href="#"><</i></a>\
						<a class="next" href="#">></a>\
					</div>\
					\
					<div class="pager">\
						1 / 6\
					</div>');*/
				_slider = insertSlider(90, "_b", 7);
				$('#slider').html(_slider);
				$(function() {
					dxSimpleSlider('#slider');
				});
				searchControl._layer = layer_09_99;
				searchControl.on('search:locationfound', function(e) {
				
					//console.log('search:locationfound', );
					layer_09_99.eachLayer(function(layer) {	//restore feature color
						layer_09_99.resetStyle(layer);
					});
					//map.removeLayer(this._markerSearch)
					e.layer.setStyle({color: 'rgba(255,255,255,0.5)', weight: '8', /*dashArray: '16, 16',*/  lineCap: 'round', lineJoin: 'round',fillColor: 'rgba(255,0,0,0.9)',});
					e.layer.bringToFront();
					map.getPane('labels').style.display = 'inline-block';
					map.getPane('labels').style['text-align'] = 'center';
					/*if(e.layer._popup)
						e.layer.openPopup();*/
						//https://bdot10k.geoportal.gov.pl/#showLayersList&1618582473368
				}).on('search:collapsed', function(e) {

						layer_09_99.eachLayer(function(layer) {	//restore feature color
							layer_09_99.resetStyle(layer);
						});	
				});
			}else  if (eventLayer.name === '2009 -> 2019') {
				l5 = eventLayer.layer._leaflet_id;
				$('.leaflet-bottom:eq( 0 )').html('<img class="leaflet-control" src="./images/2009 --_ 2019.png" style="width: 400px; opacity: 0.9; margin-bottom: 0px;">');
				/*$('#slider').html('\
					<div class="slides-container">\
						<div class="slide"><img src="legend/L01_12_b.PNG" alt="Slider img 1" ></div>\
						<div class="slide"><img src="legend/L01_13_b.PNG" alt="Slider img 2" ></div>\
						<div class="slide"><img src="legend/L01_21_b.PNG" alt="Slider img 3" ></div>\
						<div class="slide"><img src="legend/L01_23_b.PNG" alt="Slider img 4" ></div>\
						<div class="slide"><img src="legend/L01_31_b.PNG" alt="Slider img 5" ></div>\
						<div class="slide"><img src="legend/L01_32_b.PNG" alt="Slider img 6" ></div>\
					</div>\
					<div class="arrows">\
						<a class="prev" href="#"><</i></a>\
						<a class="next" href="#">></a>\
					</div>\
					\
					<div class="pager">\
						1 / 6\
					</div>');*/
				_slider = insertSlider("01", "_b", 7);
				$('#slider').html(_slider);
				$(function() {
					dxSimpleSlider('#slider');
				});
				searchControl._layer = layer_19_09;
				searchControl.on('search:locationfound', function(e) {
				
					//console.log('search:locationfound', );
					layer_19_09.eachLayer(function(layer) {	//restore feature color
						layer_19_09.resetStyle(layer);
					});
					//map.removeLayer(this._markerSearch)
					e.layer.setStyle({color: 'rgba(255,255,255,0.5)', weight: '8', /*dashArray: '16, 16',*/  lineCap: 'round', lineJoin: 'round',fillColor: 'rgba(255,0,0,0.9)',});
					e.layer.bringToFront();
					map.getPane('labels').style.display = 'inline-block';
					map.getPane('labels').style['text-align'] = 'center';
					/*if(e.layer._popup)
						e.layer.openPopup();*/
						//https://bdot10k.geoportal.gov.pl/#showLayersList&1618582473368
				}).on('search:collapsed', function(e) {

						layer_19_09.eachLayer(function(layer) {	//restore feature color
							layer_19_09.resetStyle(layer);
						});	
				});
			}else  if (eventLayer.name === '1999 -> 2019') { 
				l6 = eventLayer.layer._leaflet_id;
				$('.leaflet-bottom:eq( 0 )').html('<img class="leaflet-control" src="./images/1999 --_ 2019.png" style="width: 400px; opacity: 0.9; margin-bottom: 0px;">');
				/*$('#slider').html('\
					<div class="slides-container">\
						<div class="slide"><img src="legend/L91_12_b.PNG" alt="Slider img 1" ></div>\
						<div class="slide"><img src="legend/L91_13_b.PNG" alt="Slider img 2" ></div>\
						<div class="slide"><img src="legend/L91_21_b.PNG" alt="Slider img 3" ></div>\
						<div class="slide"><img src="legend/L91_23_b.PNG" alt="Slider img 4" ></div>\
						<div class="slide"><img src="legend/L91_31_b.PNG" alt="Slider img 5" ></div>\
						<div class="slide"><img src="legend/L91_32_b.PNG" alt="Slider img 6" ></div>\
					</div>\
					<div class="arrows">\
						<a class="prev" href="#"><</i></a>\
						<a class="next" href="#">></a>\
					</div>\
					\
					<div class="pager">\
						1 / 6\
					</div>');*/
				_slider = insertSlider(91, "_b", 7);
				$('#slider').html(_slider);
				$(function() {
					dxSimpleSlider('#slider');
				});
				searchControl._layer = layer_19_99;
				searchControl.on('search:locationfound', function(e) {
				
					//console.log('search:locationfound', );
					layer_19_99.eachLayer(function(layer) {	//restore feature color
						layer_19_99.resetStyle(layer);
					});
					//map.removeLayer(this._markerSearch)
					e.layer.setStyle({color: 'rgba(255,255,255,0.5)', weight: '8', /*dashArray: '16, 16',*/  lineCap: 'round', lineJoin: 'round',fillColor: 'rgba(255,0,0,0.9)',});
					e.layer.bringToFront();
					map.getPane('labels').style.display = 'inline-block';
					map.getPane('labels').style['text-align'] = 'center';
					/*if(e.layer._popup)
						e.layer.openPopup();*/
						//https://bdot10k.geoportal.gov.pl/#showLayersList&1618582473368
				}).on('search:collapsed', function(e) {

						layer_19_99.eachLayer(function(layer) {	//restore feature color
							layer_19_99.resetStyle(layer);
						});	
				});
			}else  if (eventLayer.name === '1999 -> 2009 ') { 
				l7 = eventLayer.layer._leaflet_id;
				$('.leaflet-bottom:eq( 0 )').html('<img class="leaflet-control" src="./images/1999 --_ 2009.png" style="width: 400px; opacity: 0.9; margin-bottom: 0px;">');
				/*$('#slider').html('\
					<div class="slides-container">\
						<div class="slide"><img src="legend/L90_12_a.PNG" alt="Slider img 1" ></div>\
						<div class="slide"><img src="legend/L90_13_a.PNG" alt="Slider img 2" ></div>\
						<div class="slide"><img src="legend/L90_21_a.PNG" alt="Slider img 3" ></div>\
						<div class="slide"><img src="legend/L90_23_a.PNG" alt="Slider img 4" ></div>\
						<div class="slide"><img src="legend/L90_31_a.PNG" alt="Slider img 5" ></div>\
						<div class="slide"><img src="legend/L90_32_a.PNG" alt="Slider img 6" ></div>\
					</div>\
					<div class="arrows">\
						<a class="prev" href="#"><</i></a>\
						<a class="next" href="#">></a>\
					</div>\
					\
					<div class="pager">\
						1 / 6\
					</div>');*/
				_slider = insertSlider(90, "_a", 7);
				$('#slider').html(_slider);
				$(function() {
					dxSimpleSlider('#slider');
				});
				searchControl._layer = layer_09_99c;
				searchControl.on('search:locationfound', function(e) {
					map.closePopup();
					//console.log('search:locationfound', );
					layer_09_99c.eachLayer(function(layer) {	//restore feature color
						layer_09_99c.resetStyle(layer);
					});
					//map.removeLayer(this._markerSearch)
					e.layer.setStyle({color: 'rgba(255,255,255,0.5)', weight: '8', /*dashArray: '16, 16',*/  lineCap: 'round', lineJoin: 'round',fillColor: 'rgba(255,0,0,0.9)',});
					e.layer.bringToFront();
					map.getPane('labels').style.display = 'inline-block';
					map.getPane('labels').style['text-align'] = 'center';
					/*if(e.layer._popup)
						e.layer.openPopup();*/
						//https://bdot10k.geoportal.gov.pl/#showLayersList&1618582473368
				}).on('search:collapsed', function(e) {

						layer_09_99c.eachLayer(function(layer) {	//restore feature color
							layer_09_99c.resetStyle(layer);
						});	
				});
			}else  if (eventLayer.name === '2009 -> 2019 ') { 
				l8 = eventLayer.layer._leaflet_id;
				$('.leaflet-bottom:eq( 0 )').html('<img class="leaflet-control" src="./images/2009 --_ 2019.png" style="width: 400px; opacity: 0.9; margin-bottom: 0px;">');
				/*$('#slider').html('\
					<div class="slides-container">\
						<div class="slide"><img src="legend/L01_12_a.PNG" alt="Slider img 1" ></div>\
						<div class="slide"><img src="legend/L01_13_a.PNG" alt="Slider img 2" ></div>\
						<div class="slide"><img src="legend/L01_21_a.PNG" alt="Slider img 3" ></div>\
						<div class="slide"><img src="legend/L01_23_a.PNG" alt="Slider img 4" ></div>\
						<div class="slide"><img src="legend/L01_31_a.PNG" alt="Slider img 5" ></div>\
						<div class="slide"><img src="legend/L01_32_a.PNG" alt="Slider img 6" ></div>\
					</div>\
					<div class="arrows">\
						<a class="prev" href="#"><</i></a>\
						<a class="next" href="#">></a>\
					</div>\
					\
					<div class="pager">\
						1 / 6\
					</div>');*/
				_slider = insertSlider("01", "_a", 7);
				$('#slider').html(_slider);
				$(function() {
					dxSimpleSlider('#slider');
				});
				searchControl._layer = layer_19_09c;
				searchControl.on('search:locationfound', function(e) {
				
					//console.log('search:locationfound', );
					layer_19_09c.eachLayer(function(layer) {	//restore feature color
						layer_19_09c.resetStyle(layer);
					});
					//map.removeLayer(this._markerSearch)
					e.layer.setStyle({color: 'rgba(255,255,255,0.5)', weight: '8', /*dashArray: '16, 16',*/  lineCap: 'round', lineJoin: 'round',fillColor: 'rgba(255,0,0,0.9)',});
					e.layer.bringToFront();
					map.getPane('labels').style.display = 'inline-block';
					map.getPane('labels').style['text-align'] = 'center';
					/*if(e.layer._popup)
						e.layer.openPopup();*/
						//https://bdot10k.geoportal.gov.pl/#showLayersList&1618582473368
				}).on('search:collapsed', function(e) {

						layer_19_09c.eachLayer(function(layer) {	//restore feature color
							layer_19_09c.resetStyle(layer);
						});	
				});
			}else  if (eventLayer.name === '1999 -> 2019 ') { 
				l9 = eventLayer.layer._leaflet_id;
				$('.leaflet-bottom:eq( 0 )').html('<img class="leaflet-control" src="./images/1999 --_ 2019.png" style="width: 400px; opacity: 0.9; margin-bottom: 0px;">');
				/*$('#slider').html('\
					<div class="slides-container">\
						<div class="slide"><img src="legend/L91_12_a.PNG" alt="Slider img 1" ></div>\
						<div class="slide"><img src="legend/L91_13_a.PNG" alt="Slider img 2" ></div>\
						<div class="slide"><img src="legend/L91_21_a.PNG" alt="Slider img 3" ></div>\
						<div class="slide"><img src="legend/L91_23_a.PNG" alt="Slider img 4" ></div>\
						<div class="slide"><img src="legend/L91_31_a.PNG" alt="Slider img 5" ></div>\
						<div class="slide"><img src="legend/L91_32_a.PNG" alt="Slider img 6" ></div>\
					</div>\
					<div class="arrows">\
						<a class="prev" href="#"><</i></a>\
						<a class="next" href="#">></a>\
					</div>\
					\
					<div class="pager">\
						1 / 6\
					</div>');*/
				_slider = insertSlider(91, "_a", 7);
				$('#slider').html(_slider);
				$(function() {
					dxSimpleSlider('#slider');
				});
				searchControl._layer = layer_19_99c;
				searchControl.on('search:locationfound', function(e) {
				
					//console.log('search:locationfound', );
					layer_19_99c.eachLayer(function(layer) {	//restore feature color
						layer_19_99c.resetStyle(layer);
					});
					//map.removeLayer(this._markerSearch)
					e.layer.setStyle({color: 'rgba(255,255,255,0.5)', weight: '8', /*dashArray: '16, 16',*/  lineCap: 'round', lineJoin: 'round',fillColor: 'rgba(255,0,0,0.9)',});
					e.layer.bringToFront();
					map.getPane('labels').style.display = 'inline-block';
					map.getPane('labels').style['text-align'] = 'center';
					/*if(e.layer._popup)
						e.layer.openPopup();*/
						//https://bdot10k.geoportal.gov.pl/#showLayersList&1618582473368
				}).on('search:collapsed', function(e) {

						layer_19_99c.eachLayer(function(layer) {	//restore feature color
							layer_19_99c.resetStyle(layer);
						});	
				});
			}else{ 
				/*$('.leaflet-bottom:eq( 0 )').html('<h3>Błąd</h3>');
				$('.triangle').html('<h3>Błąd</h3>');*/
				searchControl._layer = layer_1999;
			}
		});
		
		function rowGen(nrow, iter, u_gm, c1, c2, c3){
			return '<tr><td><div>'+(nrow+1)+ '.</div></td><td>\
				<div class="containers">\
					<a class="has-tooltip" href="#"><span style="display: block; width: 80px; margin: 0px;">'+ u_gm + '<span class="gmina">'+PLnazwa[iter][nrow]+'</span></span>\
						<span class="tooltip-wrappers">\
							<span class="tooltips"><h4 style="margin: 4px; padding: 0px; text-align: center;">Położenie:</h4>TERYT: <span class="kod">' +PLkod[iter][nrow]+'</span><br>'+ json_Powiaty_Simplified_1.getFeaturesByProperty('JPT_KOD_JE', PLpow[iter][nrow])[0].properties.JPT_NAZWA_+'<br>województwo ' +  json_Granicewojewdztw_2.getFeaturesByProperty('Wojewod', PLwoj[iter][nrow])[0].properties.JPT_NAZWA_ + '<br><h4 style="margin: 4px; padding: 0px; text-align: center;">Struktura wiekowa:</h4><table><tr><td>Przedprodukcyjny:</td><td>'+lengthToBlank1(PLudzial[Math.floor(iter/3)*3][c1])+'%</td></tr><tr><td>Produkcyjny:</td><td>'+lengthToBlank1(PLudzial[Math.floor(iter/3)*3+1][c2])+'%</td></tr><tr><td>Poprodukcyjny:</td><td>'+lengthToBlank1(PLudzial[Math.floor(iter/3)*3+2][c3])+'%</td></tr></table>\
							</span>\
						</span>\
					</a>\
				</div>\
			</td><td><div>'+lengthToBlank1(PLudzial[iter][nrow]) +'%</div></td><td><div><div style = "background-color: white; display: inline-block; padding: 0px; margin: 2px;"><div style = "background-color: ' + ((PLudzial[iter][nrow] != 100)? PLkolor[iter][nrow]:'rgba(0,0,0,0.0)')   + '; opacity: 0.8;  width: 12px; height: 100%;"></div></div></div></td></tr>';
		}
		
		/*resetLabels([layer_1999, layer_2009, layer_2019]);*/
		//resetLabels([layer_Okregi_KO]);
        map.on("zoomend", function(){
			var currentZoom = map.getZoom();
			layer_Powiaty_Simplified_1.setStyle({weight: 0.4*(currentZoom-6)+0.8});
			layer_Powiaty_Simplified_2.setStyle({weight: 0.6*(currentZoom-6)+1.2});
			//layer_Granicewojewdztw_2.setStyle({weight: Math.pow(1.4,(currentZoom-6))*1,94});
			layer_Granicewojewdztw_2.setStyle({weight: 0.8*(currentZoom-6)+1.6});
			layer_Granicewojewdztw_1.setStyle({weight: 1.2*(currentZoom-6)+2.4});
			layer_1999.setStyle({weight: Math.pow(1.1,(currentZoom-6))*0.4});
			layer_2009.setStyle({weight: Math.pow(1.1,(currentZoom-6))*0.4});
			layer_2019.setStyle({weight: Math.pow(1.1,(currentZoom-6))*0.4});
			layer_09_99.setStyle({weight: Math.pow(1.1,(currentZoom-6))*0.4});
			layer_19_09.setStyle({weight: Math.pow(1.1,(currentZoom-6))*0.4});
			layer_19_99.setStyle({weight: Math.pow(1.1,(currentZoom-6))*0.4});
			layer_09_99c.setStyle({weight: Math.pow(1.1,(currentZoom-6))*0.4});
			layer_19_09c.setStyle({weight: Math.pow(1.1,(currentZoom-6))*0.4});
			layer_19_99c.setStyle({weight: Math.pow(1.1,(currentZoom-6))*0.4});
        });
        map.on("layeradd", function(){
            /*resetLabels([layer_1999]);
			resetLabels([layer_2009]);
			resetLabels([layer_2019]);*/
        });
        map.on("layerremove", function(){
          /*resetLabels([layer_1999]);
			resetLabels([layer_2009]);
			resetLabels([layer_2019]);*/
        });
		
		map.on('popupclose', function(){
		   popOpened = false;
		  /* console.log("Zamknięty");
		   console.log(popOpened);*/
		   //setTimeout(function(){ console.log("Czekamy..."); }, 2000);
		   /*switch(layer_code){
							case l1:
								layer_1999.eachLayer(function(layer) {	//restore feature color
									layer_1999.resetStyle(layer);
								});
								break;
							case l2:
								layer_2009.eachLayer(function(layer) {	//restore feature color
									layer_2009.resetStyle(layer);
								});
								break;
							case l3:
								layer_2019.eachLayer(function(layer) {	//restore feature color
									layer_2019.resetStyle(layer);
								});
								break;
							case l4:
								layer_09_99.eachLayer(function(layer) {	//restore feature color
									layer_09_99.resetStyle(layer);
								});
								break;
							case l5:
								layer_19_09.eachLayer(function(layer) {	//restore feature color
									layer_19_09.resetStyle(layer);
								});
								break;
							case l6:
								layer_19_99.eachLayer(function(layer) {	//restore feature color
									layer_19_99.resetStyle(layer);
								});
								break;
							case l7:
								layer_09_99c.eachLayer(function(layer) {	//restore feature color
									layer_09_99c.resetStyle(layer);
								});
								break;
							case l8:
								layer_19_09c.eachLayer(function(layer) {	//restore feature color
									layer_19_09c.resetStyle(layer);
								});
								break;
							case l9:
								layer_19_99c.eachLayer(function(layer) {	//restore feature color
									layer_19_99c.resetStyle(layer);
								});
								break;
							default:
								layer_1999.eachLayer(function(layer) {	//restore feature color
									layer_1999.resetStyle(layer);
								});
					}*/
		});
		
		//zmienne
		var margl = '<div style="margin-left:20px;">';
		var thead = [];
		thead[0]='<tr style=""><th colspan="4" style="font-size: 12px;"><div><b>W wieku przedprodukcyjnym<br>- 14 lat i mniej:</b></div></th></tr>';
		thead[1]='<tr><th colspan="4" style="font-size: 12px;"><div  style="display: flex; justify-content: center; align-items: center;"><b>W wieku produkcyjnym:<br>15-59 lat kobiety, 15-64 lata mężczyźni:</b></div></th></tr>';
		thead[2]='<tr><th colspan="4" style="font-size: 12px;"><div><b>W wieku poprodukcyjnym:</b></div></th></tr>';
		var row_empty = '<tr><td colspan="4" style="font-size: 32px; background-color: #e4e4e4;"><div  style="display: flex; justify-content: center; align-items: center;"><b>...</b></div></td></tr>';
		
		
		map.on('popupopen', function(e) {
		//if (!popOpened
			var PJE = e.popup._source.feature.properties.Powiat;
			var PWE = e.popup._source.feature.properties.Wojewod;
			var powiat_nazwa = json_Powiaty_Simplified_1.getFeaturesByProperty('JPT_KOD_JE', PJE)[0].properties.JPT_NAZWA_;
			var woj_nazwa = json_Granicewojewdztw_2.getFeaturesByProperty('Wojewod', PWE)[0].properties.JPT_NAZWA_;
		$(document).ready(function ()	{
		//$('leaflet-popup  leaflet-zoom-animated').ready(function ()	{
		//setTimeout(function(){ console.log("Czekamy..."); }, 1000);
			/*if (popOpened){
				setTimeout(function(){ console.log("Czekamy..."); }, 2000);
			}*/
			
			
			
			var popupContent	= [];
			var wpopupContent	= [];
			var plpopupContent	= [];
			
			for (i=0; i<3; i++){
				popupContent[i] = new Array();
				wpopupContent[i] = new Array();
				plpopupContent[i] = new Array();
			}
			for (i=0; i<3; i++){
				popupContent[i].push(margl);
				wpopupContent[i].push(margl);
				plpopupContent[i].push(margl);
			}
			//console.log(JEkod[feature.properties['Powiat']][0][0]);
			//console.log(wpopupContent[0]);
			
			
			var curr = e.popup._source.feature.properties.JPT_KOD_JE;
			for (i=0;i<9;i++){
				var len = JEkod[PJE][i].length;
				
				popupContent[Math.floor(i/3)].push('<div style="float:left; padding: 2px; width: 200px;"><table class = "tabela" id = "fixedheight"><thead>');
				popupContent[Math.floor(i/3)].push(thead[i%3]);
				popupContent[Math.floor(i/3)].push('</thead><tbody>');
				
				if (len<8){
					for (a=0; a<JEkod[PJE][i].length;a++){
						var d1 = JEkod[PJE][Math.floor(i/3)*3].indexOf(JEkod[PJE][i][a]);
						var d2 = JEkod[PJE][Math.floor(i/3)*3+1].indexOf(JEkod[PJE][i][a]);
						var d3 = JEkod[PJE][Math.floor(i/3)*3+2].indexOf(JEkod[PJE][i][a]);
						var t_gm = (JEkod[PJE][i][a].substring(6,7)!=="1"?'gm. ':'m. ');
						if (JEkod[PJE][i][a] == curr){
							popupContent[Math.floor(i/3)].push('<tr><td style="font-weight:bold; text-align: right;"><div>'+(a+1)+ '.</div></td><td style="font-weight:bold"><div>' + t_gm + JEnazwa[PJE][i][a]+'</div></td><td style="font-weight:bold"><div>'+lengthToBlank1(JEudzial[PJE][i][a]) +'%</div></td><td><div><div style = "background-color: white; display: inline-block; padding: 0px; margin: 2px;"><div style = "background-color: ' + ((JEudzial[PJE][i][a] != 100)? JEkolor[PJE][i][a]:'rgba(0,0,0,0.0)')  + '; opacity: 0.8; width: 12px; height: 100%;"></div></div></div></td></tr>');
							
						}else{
							popupContent[Math.floor(i/3)].push('<tr><td style="text-align: right;"><div>'+(a+1)+ '.</div></td><td>\
								<div class="containers">\
									<a class="has-tooltip" href="#"><span style="display: block; width: 80px; margin: 0px;">'+t_gm + '<span class="gmina">'+JEnazwa[PJE][i][a]+'</span></span>\
										<span class="tooltip-wrappers">\
											<span class="tooltips"><h4 style="margin: 4px; padding: 0px; text-align: center;">Położenie:</h4>TERYT: <span class="kod">' +JEkod[PJE][i][a]+'</span><br><h4 style="margin: 4px; padding: 0px; text-align: center;">Struktura wiekowa:</h4><table id="popt"><tr><td>Przedprodukcyjny:</td><td>'+lengthToBlank1(JEudzial[PJE][Math.floor(i/3)*3][d1])+'%</td></tr><tr><td>Produkcyjny:</td><td>'+lengthToBlank1(JEudzial[PJE][Math.floor(i/3)*3+1][d2])+'%</td></tr><tr><td>Poprodukcyjny:</td><td>'+lengthToBlank1(JEudzial[PJE][Math.floor(i/3)*3+2][d3])+'%</td></tr></table>\
											</span>\
										</span>\
									</a>\
								</div>\
							</td><td><div>'+lengthToBlank1(JEudzial[PJE][i][a]) +'%</div></td><td><div>'+'<div style = "background-color: white; display: inline-block; padding: 0px; margin: 2px;"><div style = "background-color: ' + ((JEudzial[PJE][i][a] != 100)? JEkolor[PJE][i][a]:'rgba(0,0,0,0.0)')   + '; opacity: 0.8;  width: 12px; height: 100%;"></div></div></div></td></tr>');
						}
					}
				}else{
					var ind = JEkod[PJE][i].indexOf(curr);
					for (b=0; b<len;b++){
						var t_gm = (JEkod[PJE][i][b].substring(6,7)!=="1"?'gm. ':'m. ');
						
						var d1 = JEkod[PJE][Math.floor(i/3)*3].indexOf(JEkod[PJE][i][b]);
						var d2 = JEkod[PJE][Math.floor(i/3)*3+1].indexOf(JEkod[PJE][i][b]);
						var d3 = JEkod[PJE][Math.floor(i/3)*3+2].indexOf(JEkod[PJE][i][b]);
						var row = '<tr><td style="text-align: right;"><div>'+(b+1)+ '.</div></td><td>\
								<div class="containers">\
									<a class="has-tooltip" href="#"><span style="display: block; width: 80px; margin: 0px; text-align: center;">'+t_gm + '<span class="gmina">'+JEnazwa[PJE][i][b]+'</span></span>\
										<span class="tooltip-wrappers">\
											<span class="tooltips"><h4 style="margin: 4px; padding: 0px; text-align: center;">Położenie:</h4>TERYT: <span class="kod">' +JEkod[PJE][i][b]+'</span><br><h4 style="margin: 4px; padding: 0px; text-align: center;">Struktura wiekowa:</h4><table><tr><td>Przedprodukcyjny:</td><td>'+lengthToBlank1(JEudzial[PJE][Math.floor(i/3)*3][d1])+'%</td></tr><tr><td>Produkcyjny:</td><td>'+lengthToBlank1(JEudzial[PJE][Math.floor(i/3)*3+1][d2])+'%</td></tr><tr><td>Poprodukcyjny:</td><td>'+lengthToBlank1(JEudzial[PJE][Math.floor(i/3)*3+2][d3])+'%</td></tr></table>\
											</span>\
										</span>\
									</a>\
								</div>\
							</td><td><div>'+lengthToBlank1(JEudzial[PJE][i][b]) +'%</div></td><td><div>'+'<div style = "background-color: white; display: inline-block; padding: 0px; margin: 2px;"><div style = "background-color: ' + ((JEudzial[PJE][i][b] != 100)? JEkolor[PJE][i][b]:'rgba(0,0,0,0.0)')   + '; opacity: 0.8;  width: 12px; height: 100%;"></div></div></div></td></tr>';
						var row_curr = '<tr><td style="font-weight:bold; text-align: right;"><div>'+(b+1)+ '.</div></td><td style="font-weight:bold"><div>' + t_gm + JEnazwa[PJE][i][b]+'</div></td><td style="font-weight:bold"><div>'+lengthToBlank1(JEudzial[PJE][i][b])+'%</div></td><td><div>'+'<div style = "background-color: white; display: inline-block; padding: 0px; margin: 2px;"><div style = "background-color: ' + ((JEudzial[PJE][i][b] != 100)? JEkolor[PJE][i][b]:'rgba(0,0,0,0.0)')   + '; opacity: 0.8;  width: 12px; height: 100%;"></div></div></div></td></tr>';
						if(ind<2||ind>len-3){
							if(b<3||b>len-4){
								if (b == ind){
									popupContent[Math.floor(i/3)].push(row_curr);
								}else{
									popupContent[Math.floor(i/3)].push(row);
								}
							}else if (b==3){
								popupContent[Math.floor(i/3)].push( row_empty);
							}
						}else if(ind==len-3){
							if(b==len-3){
								popupContent[Math.floor(i/3)].push( row_curr);
							}else if(b<2||b>len-3||b==ind-1){
								popupContent[Math.floor(i/3)].push(row);
							}else if (b==3){
								popupContent[Math.floor(i/3)].push( row_empty);
							}
						}else if(ind==2){
							if(b==2){
								popupContent[Math.floor(i/3)].push(row_curr);
							}else if(b<2||b>len-3||b==ind+1){
								popupContent[Math.floor(i/3)].push(row);
							}else if (b==4){
								popupContent[Math.floor(i/3)].push( row_empty);
							}
						}else{
							if(b==ind){
								popupContent[Math.floor(i/3)].push(row_curr);
							}else if(b==0||b==len-1||b==ind+1||b==ind-1){
								popupContent[Math.floor(i/3)].push(row);
							}else if (b==1||b==len-2){
								popupContent[Math.floor(i/3)].push( row_empty);
							}
						}
					}
				}
				popupContent[Math.floor(i/3)].push('</tbody></table></div>');
			}
			
			//json_Demografia.features.
			var curr = e.popup._source.feature.properties.JPT_KOD_JE;
			for (i=0;i<9;i++){
				var len = WEkod[PWE][i].length;
				wpopupContent[Math.floor(i/3)].push('<div style="float:left; padding: 2px; width: 200px;"><table class = "tabela" id = "fixedheight"><thead>');
				wpopupContent[Math.floor(i/3)].push(thead[i%3]);
				wpopupContent[Math.floor(i/3)].push('</thead><tbody>');
					var ind = WEkod[PWE][i].indexOf(curr);
					for (b=0; b<len;b++){
						var d1 = WEkod[PWE][Math.floor(i/3)*3].indexOf(WEkod[PWE][i][b]);
						var d2 = WEkod[PWE][Math.floor(i/3)*3+1].indexOf(WEkod[PWE][i][b]);
						var d3 = WEkod[PWE][Math.floor(i/3)*3+2].indexOf(WEkod[PWE][i][b]);
						var t_gm = (WEkod[PWE][i][b].substring(6,7)!=="1"?'gm. ':'m. ');
						var row = '<tr><td><div>'+(b+1)+ '.</div></td><td>\
								<div class="containers">\
									<a class="has-tooltip" href="#"><span style="display: block; width: 80px; margin: 0px;">'+t_gm + '<span class="gmina">'+WEnazwa[PWE][i][b]+'</span></span>\
										<span class="tooltip-wrappers">\
											<span class="tooltips"><h4 style="margin: 4px; padding: 0px; text-align: center;">Położenie:</h4>TERYT: <span class="kod">' +WEkod[PWE][i][b]+'</span><br>'+  json_Powiaty_Simplified_1.getFeaturesByProperty('JPT_KOD_JE', WEpow[PWE][i][b])[0].properties.JPT_NAZWA_+ '<br><h4 style="margin: 4px; padding: 0px; text-align: center;">Struktura wiekowa:</h4><table><tr><td>Przedprodukcyjny:</td><td>'+lengthToBlank1(WEudzial[PWE][Math.floor(i/3)*3][d1])+'%</td></tr><tr><td>Produkcyjny:</td><td>'+lengthToBlank1(WEudzial[PWE][Math.floor(i/3)*3+1][d2])+'%</td></tr><tr><td>Poprodukcyjny:</td><td>'+lengthToBlank1(WEudzial[PWE][Math.floor(i/3)*3+2][d3])+'%</td></tr></table>\
											</span>\
										</span>\
									</a>\
								</div>\
							</td><td><div>'+lengthToBlank1(WEudzial[PWE][i][b]) +'%</div></td><td><div><div style = "background-color: white; display: inline-block; padding: 0px; margin: 2px;"><div style = "background-color: ' + ((WEudzial[PWE][i][b] != 100)? WEkolor[PWE][i][b]:'rgba(0,0,0,0.0)')   + '; opacity: 0.8;  width: 12px; height: 100%;"></div></div></div></td></tr>';
							
						var row_curr = '<tr><td style="font-weight:bold; text-align: right;"><div>'+(b+1)+ '.</div></td><td style="font-weight:bold"><div>' + t_gm + WEnazwa[PWE][i][b]+'</div></td><td style="font-weight:bold"><div>'+lengthToBlank1(WEudzial[PWE][i][b]) +'%</div></td><td><div><div style = "background-color: white; display: inline-block; padding: 0px; margin: 2px;"><div style = "background-color: ' + ((WEudzial[PWE][i][b] != 100)? WEkolor[PWE][i][b]:'rgba(0,0,0,0.0)')   + '; opacity: 0.8;  width: 12px; height: 100%;"></div></div></div></td></tr>';
						
						if(ind<2||ind>len-3){
							if(b<3||b>len-4){
								if (b == ind){
									wpopupContent[Math.floor(i/3)].push(row_curr);
								}else{
									wpopupContent[Math.floor(i/3)].push(row);
								}
							}else if (b==3){
								wpopupContent[Math.floor(i/3)].push(row_empty);
							}
						}else if(ind==len-3){
							if(b==len-3){
								wpopupContent[Math.floor(i/3)].push(row_curr);
							}else if(b<2||b>len-3||b==ind-1){
								wpopupContent[Math.floor(i/3)].push(row);
							}else if (b==3){
								wpopupContent[Math.floor(i/3)].push(row_empty);
							}
						}else if(ind==2){
							if(b==2){
								wpopupContent[Math.floor(i/3)].push(row_curr);
							}else if(b<2||b>len-3||b==ind+1){
								wpopupContent[Math.floor(i/3)].push(row);
							}else if (b==4){
								wpopupContent[Math.floor(i/3)].push(row_empty);
							}
						}else{
							if(b==ind){
								wpopupContent[Math.floor(i/3)].push(row_curr);
							}else if(b==0||b==len-1||b==ind+1||b==ind-1){
								wpopupContent[Math.floor(i/3)].push(row);
							}else if (b==1||b==len-2){
								wpopupContent[Math.floor(i/3)].push(row_empty);
							}
						}
					}
				//wpopupContent[Math.floor(i/3)] =  wpopupContent[Math.floor(i/3)] +'</tbody></table></div>';
				wpopupContent[Math.floor(i/3)].push('</tbody></table></div>');
			}
			
			var curr = e.popup._source.feature.properties.JPT_KOD_JE;
			for (i=0;i<9;i++){
				var len = PLkod[i].length;
				var row = "";
				
				//console.log(len);
				plpopupContent[Math.floor(i/3)].push('<div style="float:left; padding: 2px; width: 200px;"><table class = "tabela" id = "fixedheight"><thead>');
				plpopupContent[Math.floor(i/3)].push(thead[i%3]);
				plpopupContent[Math.floor(i/3)].push('</thead><tbody>');
					var row_curr;
					var ind = PLkod[i].indexOf(curr);
					//console.log(ind);
					
					if  (typeof PLkod[i][ind]!== 'undefined'){
						var t_gm = (PLkod[i][ind].substring(6,7)!=="1"?'gm. ':'m. ');
						row_curr = '<tr><td style="font-weight:bold; text-align: right;"><div>'+(ind+1)+ '.</div></td><td style="font-weight:bold"><div>' + t_gm + PLnazwa[i][ind]+'</div></td><td style="font-weight:bold"><div>'+lengthToBlank1(PLudzial[i][ind]) +'%</div></td><td><div><div style = "background-color: white; display: inline-block; padding: 0px; margin: 2px;"><div style = "background-color: ' + ((PLudzial[i][ind] != 100)? PLkolor[i][ind]:'rgba(0,0,0,0.0)')   + '; opacity: 0.8;  width: 12px; height: 100%;"></div></div></div></td></tr>';
					}else{
						row_curr = '';
					}
					for (b=0; b<len;b++){
						var d1 = PLkod[Math.floor(i/3)*3].indexOf(PLkod[i][b]);
						var d2 = PLkod[Math.floor(i/3)*3+1].indexOf(PLkod[i][b]);
						var d3 = PLkod[Math.floor(i/3)*3+2].indexOf(PLkod[i][b]);
						var t_gm = (PLkod[i][b].substring(6,7)!=="1"?'gm. ':'m. ');
						
						
						if(ind<2||ind>len-3){
							if(b<3||b>len-4){
								if (b == ind){
									plpopupContent[Math.floor(i/3)].push(row_curr);
								}else{
									row = rowGen(b, i, t_gm, d1, d2, d3);
									plpopupContent[Math.floor(i/3)].push(row);
								}
							}else if (b==3){
								plpopupContent[Math.floor(i/3)].push(row_empty);
							}
						}else if(ind==len-3){
							if(b==len-3){
								plpopupContent[Math.floor(i/3)].push(row_curr);
							}else if(b<2||b>len-3||b==ind-1){
								row = rowGen(b, i, t_gm, d1, d2, d3);
								plpopupContent[Math.floor(i/3)].push(row);
							}else if (b==3){
								plpopupContent[Math.floor(i/3)].push(row_empty);
							}
						}else if(ind==2){
							if(b==2){
								plpopupContent[Math.floor(i/3)].push(row_curr);
							}else if(b<2||b>len-3||b==ind+1){
								row = rowGen(b, i, t_gm, d1, d2, d3);
								plpopupContent[Math.floor(i/3)].push(row);
							}else if (b==4){
								plpopupContent[Math.floor(i/3)].push(row_empty);
							}
						}else{
							if(b==ind){
								plpopupContent[Math.floor(i/3)].push(row_curr);
							}else if(b==0||b==len-1||b==ind+1||b==ind-1){
								row = rowGen(b, i, t_gm, d1, d2, d3);
								plpopupContent[Math.floor(i/3)].push(row);
							}else if (b==1||b==len-2){
								plpopupContent[Math.floor(i/3)].push(row_empty);
							}
						}
					}
				/*}*/
				plpopupContent[Math.floor(i/3)].push('</tbody></table></div>');
			}
			for (i=0; i<3; i++){
				popupContent[i].push('<div style="clear:both;"></div></div>');
			}
			for (i=0; i<3; i++){
				plpopupContent[i].push('<div style="clear:both;"></div></div>');
				wpopupContent[i].push('<div style="clear:both;"></div></div>');
				
			}
			$('#tab2').ready(function ()	{
			$('#tab2').html('<h5 style = "margin-left:28px; color: #282828;">'+powiat_nazwa+':</h5>');
			$('#tab3').html('<h5 style = "margin-left:28px; color: #282828;">'+powiat_nazwa+':</h5>');
			$('#tab4').html('<h5 style = "margin-left:28px; color: #282828;">'+powiat_nazwa+':</h5>');
			/*$("#tab2").scroll(function () { 
				$("#tab3").scrollTop($("#tab2").scrollTop());
				$("#tab4").scrollTop($("#tab2").scrollTop());
			});
			$("#tab3").scroll(function () { 
				$("#tab2").scrollTop($("#tab3").scrollTop());
				$("#tab4").scrollTop($("#tab3").scrollTop());
			});
			$("#tab4").scroll(function () { 
				$("#tab2").scrollTop($("#tab4").scrollTop());
				$("#tab3").scrollTop($("#tab4").scrollTop());
			});*/
			for (i=0; i<3; i++){
				$('#tab'+(i+2)).append('<p>'+popupContent[i].join("")+'</p>');
				$('#tab'+(i+2)).append('<h5  id = "tooltip-2" style = "margin-left:28px; color: #282828;">województwo ' + woj_nazwa + ':</h5>');
				$('#tab'+(i+2)).append('<p>'+wpopupContent[i].join("")+'</p>');
				$('#tab'+(i+2)).append('<h5 style = "margin-left:28px; color: #282828;">Polska:</h5>');
				$('#tab'+(i+2)).append('<p>'+plpopupContent[i].join("")+'</p>');
				$( "p" ).remove( ":contains('undefined')" );
				//$("#tooltip-2").tooltip();
			}
			
			$("#tab2").scroll(function () { 
				sc = $("#tab2").scrollTop();
				$('.tooltips').css("bottom",(sc+24)+"px");
				//console.log(sc);
				/*$("#tab3").scrollTop(sc);
				$("#tab4").scrollTop(sc);*/
				//console.log("#tab2 was scrolled.");
			});
			$("#tab3").scroll(function () { 
				sc = $("#tab3").scrollTop();
				$('.tooltips').css("bottom",(sc+24)+"px");
				//console.log(sc);
				/*$("#tab2").scrollTop(sc);
				$("#tab4").scrollTop(sc);*/
				//console.log("#tab3 was scrolled.");
			});
			$("#tab4").scroll(function () { 
				sc = $("#tab4").scrollTop();
				$('.tooltips').css("bottom",(sc+24)+"px");
				//console.log(sc);
				/*$("#tab2").scrollTop(sc);
				$("#tab3").scrollTop(sc);*/
				//console.log("#tab4 was scrolled.");
			});
		  /*console.log(e.popup._source.feature.properties.Wojewod);*/
		  /*$('.tab-content').click(function(e){
			console.log("One of the many Small Polygon Links was clicked");
		  });*/
		  $('.tabs .tab-links a').on('mouseenter',function(e) {
						//var currentAttrValue = $(this).attr('href');

						// Show/Hide Tabs
						if ($(this).parent('li').prev().hasClass('active')){
							//console.log("Tak!!!");
							
							//$(this).parent('li').prev().children('a').addClass('tab-links extra_stuff').parent('li').siblings().children('a').removeClass('tab-links extra_stuff');
							//console.log($(this).parent('li').prev().children('a'));
							$("#workAround").html(".tabs .active a:after {background: #7fbc41;}"); //Działa
						}else{
							//console.log("Nie!!!");
							$("#workAround").html(".tabs .active a:after {background: #4d9221;}")/*.animate({background: #7fbc41}, 150)*/;
						}
						
						if ($(this).parent('li').next().hasClass('active')){
							//console.log("pTak!!!");
							
							//$(this).parent('li').prev().children('a').addClass('tab-links extra_stuff').parent('li').siblings().children('a').removeClass('tab-links extra_stuff');
							//console.log($(this).parent('li').next().children('a'));
							$("#workAround").html(".tabs .active a:before {background: #7fbc41;}");
						}else{
							//console.log("pNie!!!");
							//$("#workAround").html(".tabs .active a:before {background: #a700e5;}");
						}
						// Change/remove current tab to active
						//$(this).parent('li').addClass('active').siblings().removeClass('active');

						//e.preventDefault();
					});
					$('.tabs .tab-links a').on('mouseleave',function(e) {
						$("#workAround").html(".tabs .active a:after {background: #7F00DA;}");
						//$("#workAround").html(".tabs .tab-links:last-of-type a:after {background: #222;}");
						$("#workAround").html(".tabs .active a:before {background: #4d9221;}");
					});
					$('.tabs .tab-links a').on('click', function(e) {
						var currentAttrValue = $(this).attr('href');

						// Show/Hide Tabs
						$('.tabs ' + currentAttrValue).show().siblings().hide();
						
						// Change/remove current tab to active
						$(this).parent('li').addClass('active').siblings().removeClass('active');
						$("#workAround").html(".tabs .active a:after {background: #4d9221;}");
						$("#tab2").scrollTop(sc);
						$("#tab3").scrollTop(sc);
						$("#tab4").scrollTop(sc);
						//this.className="thing1 extra_stuff";
						e.preventDefault();
					});
			$('.has-tooltip span').on('click',function(e) {
				var gmina = $(this).children('.gmina').text();
				var kod = $(this).parent().children('.tooltip-wrappers').children('.tooltips').children('.kod').text();
				if (gmina&&kod){
					//console.log(layer_code); 
					switch(layer_code){
							case l1:
								layer_1999.eachLayer(function(layer) {	//restore feature color
									layer_1999.resetStyle(layer);
								});
								break;
							case l2:
								layer_2009.eachLayer(function(layer) {	//restore feature color
									layer_2009.resetStyle(layer);
								});
								break;
							case l3:
								layer_2019.eachLayer(function(layer) {	//restore feature color
									layer_2019.resetStyle(layer);
								});
								break;
							case l4:
								layer_09_99.eachLayer(function(layer) {	//restore feature color
									layer_09_99.resetStyle(layer);
								});
								break;
							case l5:
								layer_19_09.eachLayer(function(layer) {	//restore feature color
									layer_19_09.resetStyle(layer);
								});
								break;
							case l6:
								layer_19_99.eachLayer(function(layer) {	//restore feature color
									layer_19_99.resetStyle(layer);
								});
								break;
							case l7:
								layer_09_99c.eachLayer(function(layer) {	//restore feature color
									layer_09_99c.resetStyle(layer);
								});
								break;
							case l8:
								layer_19_09c.eachLayer(function(layer) {	//restore feature color
									layer_19_09c.resetStyle(layer);
								});
								break;
							case l9:
								layer_19_99c.eachLayer(function(layer) {	//restore feature color
									layer_19_99c.resetStyle(layer);
								});
								break;
							default:
								layer_1999.eachLayer(function(layer) {	//restore feature color
									layer_1999.resetStyle(layer);
								});
					}
					
					//console.log(gmina+' | '+kod);
					searchControl._input.value = gmina+' | '+kod;
					searchControl._handleSend();
					//map.closePopup();
					searchControl.options.moveToLocation=function(latlng, title, map) {
						map.fitBounds( latlng.layer.getBounds() );
						var zoom = map.getBoundsZoom(latlng.layer.getBounds());
						map.setView(latlng, zoom); // access the zoom
					}
					searchControl.on('search:locationfound', function(e) {
						//e.preventDefault();
						map.closePopup();
						resetLabels([layer_Powiaty_Simplified_1]);
						e.layer.openPopup();
					});
				}else{
					//console.log("Katastrofa"); 
				}
			});
		});
		popOpened = true;
		/*console.log("Otwarty");
		console.log(popOpened);*/
		
		//}
		});
		/*$(document).ready(function ()	{
			if(popOpened){
				e.popup.update();
			}
		});*/
		});
		/*map.on('moveend', function() {
		map.getBounds();
		//erase the features you had on the map
		//Then load on the map only the features with coordinates inside the Bounging Box. 
		});*/
		//map.on('zoomend', function());
		//show_hide_labels();
		</script>
    </body>
</html>
